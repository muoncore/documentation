<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Muon - Reactive APIs</title>
  <meta name="description" content="">

    <link rel="stylesheet" href="/css/foundation.css">

    <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/fontello.css">
  <link rel="stylesheet" href="/css/font-awesome.css">
  <script src="/javascripts/modernizr.foundation.js" type="text/javascript"></script>
    <script src="/javascripts/jquery-2.1.0.js" type="text/javascript"></script>
    <script src="/javascripts/terrific-1.1.1.js" type="text/javascript"></script>
    <script src="/javascripts/jquery.url.js" type="text/javascript"></script>
    <script src="/javascripts/jquery.cookie.js" type="text/javascript"></script>
    <script src="/javascripts/json2.js" type="text/javascript"></script>
    <script src="/javascripts/foundation.js" type="text/javascript"></script>
  <script>
    // terrificjs bootstrap
    (function($) {
        $(document).ready(function() {
            var $page = $('body');
            var config = {
              dependencyPath: {
                plugin: 'javascripts/'
              }
            }
            var application = new Tc.Application($page, config);
            application.registerModules();
            application.start();
        });
    })(Tc.$);
  </script>
  <link href="http://fonts.googleapis.com/css?family=Raleway:400,700,300" media="screen" rel="stylesheet" type="text/css" />
  <script src="/javascripts/masonry.pkgd.js" type="text/javascript"></script>
  <script src="/javascripts/imagesloaded.pkgd.min.js" type="text/javascript"></script>
  <script src="/javascripts/slick.min.js" type="text/javascript"></script>

  <link rel="canonical" href="/submodules/java/doc/">
  <link rel="alternate" type="application/rss+xml" title="Muon - Reactive APIs" href="/feed.xml" />
  <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
          <link rel="stylesheet" href="/css/asciidoc.css">
          <link rel="stylesheet" href="/css/producttable.css">
                  <style>
  @media only screen and (min-width:768px){#toctitle{font-size:1.375em}
      body.toc2{padding-left:15em;padding-right:0}
#toc {margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;right:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc >ul{font-size:.9em;margin-bottom:0}
#toc ul ul{margin-left:0;padding-left:1em}
#toc ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
  @media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc {width:20em}
#toc #toctitle{font-size:1.375em}
#toc >ul{font-size:.95em}
#toc ul ul{padding-left:1.25em}
      body.toc2.toc-right{padding-left:0;padding-right:20em}}

#toc { z-index:20; padding-top:120px;}
#documentation { padding-left:10px; margin-left:auto; margin-right:auto}
#documentation .row { margin:auto }
      code {
          background:none;
          border:0;
      }

      code span { border: 0; width:100% }
      .listingblock {
         background: #eee;
         border-radius:5px;
          border:1px solid #ccc
      }
  }

  div.documentation a.btn {
    margin-top:20px;
    background: #3498db;
    background-image: -webkit-linear-gradient(top, #3498db, #2980b9);
    background-image: -moz-linear-gradient(top, #3498db, #2980b9);
    background-image: -ms-linear-gradient(top, #3498db, #2980b9);
    background-image: -o-linear-gradient(top, #3498db, #2980b9);
    background-image: linear-gradient(to bottom, #3498db, #2980b9);
    -webkit-border-radius: 28;
    -moz-border-radius: 28;
    border-radius: 28px;
    font-family: Arial;
    color: #ffffff;
    font-size: 20px;
    padding: 10px 20px 10px 20px;
    text-decoration: none;
  }

  div.documentation a.btn:hover {
    background: #3cb0fd;
    background-image: -webkit-linear-gradient(top, #3cb0fd, #3498db);
    background-image: -moz-linear-gradient(top, #3cb0fd, #3498db);
    background-image: -ms-linear-gradient(top, #3cb0fd, #3498db);
    background-image: -o-linear-gradient(top, #3cb0fd, #3498db);
    background-image: linear-gradient(to bottom, #3cb0fd, #3498db);
    text-decoration: none;
  }

  </style>

  <link rel="stylesheet" href="/css/sidebar2.css">
</head>


  <body>
    
      <a id='top'></a>
<div class='contain-to-grid sticky fullwidth'>
  <nav class='top-bar onepage' data-options='sticky_on: large' data-topbar=''>
    <ul class='title-area'>
      <li class='name'>
        <h1>
          <a href="/">
            <img alt="" src="/images/muonlogo.png" style="width:50px; height:50px" /> Muon
          </a>
        </h1>
      </li>
      <li class='toggle-topbar menu-icon'>
        <a href='#'>Menu</a>
      </li>
    </ul>
    <span style="float:left">Reactive APIs for Microservices, Browser and More ...</span>
    <section class='top-bar-section'>
      <ul class='right'>
        
          
            <li>
              
                <a href="/#ce">OSS/ CE</a>
              

            </li>
          
        
          
            <li>
              
                <a href="guide/index.html">Guides</a>
              

            </li>
          
        
          
            <li>
              
                <a href="/pro.html">Pro</a>
              

            </li>
          
        
          
            <li class="has-dropdown">
              <a href="/guide/index.html">Docs</a>
              <ul class='dropdown'>
                
                  <li>
                    <a href="/guide/index.html">Guides</a>
                  </li>
                
                  <li>
                    <a href="/submodules/cli/doc/index.html">CLI</a>
                  </li>
                
                  <li>
                    <a href="/submodules/java/doc/">Java</a>
                  </li>
                
                  <li>
                    <a href="/submodules/clojure/doc/index.html">Clojure</a>
                  </li>
                
                  <li>
                    <a href="/submodules/node/doc/index.html">Node.JS</a>
                  </li>
                
                  <li>
                    <a href="/submodules/muonjs/doc/index.html">Browser</a>
                  </li>
                
                  <li>
                    <a href="/submodules/photon/doc/index.html">Photon - Event Store</a>
                  </li>
                
              </ul>
            </li>
          
        
          
            <li>
              
                <a href="https://github.com/muoncore">Github</a>
              

            </li>
          
        
      </ul>
    </section>
  </nav>
</div>
<div class='full no-padding'>
  <!-- Begin MailChimp Signup Form -->
  <link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
  <style type="text/css">
    #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
    /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
         We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
  </style>
  <div id="mc_embed_signup">
    <form action="//simplicityitself.us9.list-manage.com/subscribe/post?u=fce1e12e8f44592cf75288e11&amp;id=98e2ce96d8" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
      <div id="mc_embed_signup_scroll">
        <label for="mce-EMAIL">Get updated on new releases and features</label>
        <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_fce1e12e8f44592cf75288e11_98e2ce96d8" tabindex="-1" value=""></div>
        <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
      </div>
    </form>
  </div>
</div>

    

    <div id='main' role='main'>
      <div class="documentation">
<div class='full' style='background: #000'>
  <div class='row' style="margin-left:0; margin-right:0; max-width:100%">
    <div class='large-12 columns'>
      <div class='mod modBlogPost big'>
        <div class='images'>
          
        </div>
        <div class='content' style="font-size:1.2rem; max-width:80%">
          <div id="toc" class="toc">
<div id="toctitle">Muon Java</div>
<ul class="sectlevel1">
<li><a href="#muon-java">Muon Java</a>
<ul class="sectlevel2">
<li><a href="#a-microservice-based-system-in-5-minutes">A Microservice based system in 5 minutes</a></li>
<li><a href="#core-features">Core Features</a>
<ul class="sectlevel3">
<li><a href="#reactive-rpc">Reactive RPC</a>
<ul class="sectlevel4">
<li><a href="#simple-rpc">Simple RPC</a></li>
<li><a href="#making-it-reactive">Making it Reactive</a></li>
<li><a href="#batch-handling-rpc">Batch handling RPC</a></li>
</ul>
</li>
<li><a href="#reactive-streams">Reactive Streams</a></li>
<li><a href="#wiretap">Wiretap</a></li>
</ul>
</li>
<li><a href="#event-based-systems">Event Based Systems</a>
<ul class="sectlevel3">
<li><a href="#running-an-event-store">Running an Event Store</a></li>
<li><a href="#setting-up-the-event-client">Setting up the event client</a></li>
<li><a href="#emitting-events">Emitting Events</a></li>
<li><a href="#replaying-events">Replaying Events</a></li>
<li><a href="#event-sourcing">Event Sourcing</a></li>
<li><a href="#using-event-projections">Using Event Projections</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#extending-muon-java">Extending Muon Java</a>
<ul class="sectlevel2">
<li><a href="#encoding">Encoding</a></li>
<li><a href="#transports">Transports</a></li>
<li><a href="#discovery">Discovery</a></li>
<li><a href="#adding-a-new-interaction-protocol">Adding a new interaction protocol</a>
<ul class="sectlevel3">
<li><a href="#designing-a-protocol">Designing a Protocol</a></li>
<li><a href="#client-side">Client Side</a>
<ul class="sectlevel4">
<li><a href="#designing-building-a-muon-client-process">Designing Building a Muon Client Process</a></li>
<li><a href="#designing-the-user-api-and-protocol-stack">Designing the User API and Protocol Stack</a></li>
</ul>
</li>
<li><a href="#server-side">Server Side</a>
<ul class="sectlevel4">
<li><a href="#designing-building-a-muon-server-process">Designing Building a Muon Server Process</a></li>
<li><a href="#registering-the-serverstack">Registering the ServerStack</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="paragraph">
<p>The current version is 7.3.2</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This document is maintained at <a href="https://github.com/muoncore/muon-java" class="bare">https://github.com/muoncore/muon-java</a>.
Please submit issues at that repository.
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="muon-java">Muon Java</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Muon Java is the implementation of the Muon microservices toolkit, for the Java platform. Muon enables you to easily build
microservices in many languages that have richer, more performant and fully reactive communication semantics and gain access
to Muon compatible services written in other languages without having to sacrifice the rich semantics or performance.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Contributing</div>
<div class="paragraph">
<p>Muon and the ecosystem services are open source.
Contribute to Muon Java and this documentation at <a href="http://github.com/muoncore/muon-java" class="bare">http://github.com/muoncore/muon-java</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a-microservice-based-system-in-5-minutes">A Microservice based system in 5 minutes</h3>
<div class="paragraph">
<p>The quickest way to start a new Muon Java Microservice is to clone the example
repo at <a href="https://github.com/muoncore/muon-java-gradle-example" class="bare">https://github.com/muoncore/muon-java-gradle-example</a></p>
</div>
<div class="paragraph">
<p>This is set up to use Gradle as the build tool and Java as the application
language.</p>
</div>
<div class="paragraph">
<p>First, install the Muon CLI, then clone this repository.</p>
</div>
<div class="paragraph">
<p>This project has an example service already in there that looks similar to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">MuonServerExample</span> <span style="color: #666666">{</span>


    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">static</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">main</span><span style="color: #666666">(</span>String<span style="color: #666666">[]</span> args<span style="color: #666666">)</span> <span style="color: #008000; font-weight: bold">throws</span> Exception <span style="color: #666666">{</span>
        AutoConfiguration config <span style="color: #666666">=</span> MuonConfigBuilder
                      <span style="color: #666666">.</span><span style="color: #7D9029">withServiceIdentifier</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;example-service&quot;</span><span style="color: #666666">).</span><span style="color: #7D9029">build</span><span style="color: #666666">();</span> <i class="conum" data-value="1"></i><b>(1)</b>

        Muon muon <span style="color: #666666">=</span> MuonBuilder<span style="color: #666666">.</span><span style="color: #7D9029">withConfig</span><span style="color: #666666">(</span>config<span style="color: #666666">).</span><span style="color: #7D9029">build</span><span style="color: #666666">();</span>              <i class="conum" data-value="2"></i><b>(2)</b>

        muon<span style="color: #666666">.</span><span style="color: #7D9029">handleRequest</span><span style="color: #666666">(</span>all<span style="color: #666666">(),</span> request <span style="color: #666666">-&gt;</span> <span style="color: #666666">{</span>                           <i class="conum" data-value="3"></i><b>(3)</b>
            System<span style="color: #666666">.</span><span style="color: #7D9029">out</span><span style="color: #666666">.</span><span style="color: #7D9029">println</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;A request has been made &quot;</span><span style="color: #666666">);</span>
            Map data <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> HashMap<span style="color: #666666">();</span>
            data<span style="color: #666666">.</span><span style="color: #7D9029">put</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;Hello&quot;</span><span style="color: #666666">,</span> <span style="color: #BA2121">&quot;world &quot;</span> <span style="color: #666666">+</span> System<span style="color: #666666">.</span><span style="color: #7D9029">currentTimeMillis</span><span style="color: #666666">());</span>
            request<span style="color: #666666">.</span><span style="color: #7D9029">ok</span><span style="color: #666666">(</span>data<span style="color: #666666">);</span>                                            <i class="conum" data-value="4"></i><b>(4)</b>
        <span style="color: #666666">});</span>
        System<span style="color: #666666">.</span><span style="color: #7D9029">out</span><span style="color: #666666">.</span><span style="color: #7D9029">println</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;Use Ctrl-C to exit&quot;</span><span style="color: #666666">);</span>
    <span style="color: #666666">}</span>
<span style="color: #666666">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a muon configuration using a fluent interface builder.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Construct a Muon instance from the config. It will appear in the network soon after this.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Setup an RPC Protocol Handler, for all request paths.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>When invoked, respond to the RPC request with some manufactured data.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can run this from a prebuilt Gradle task</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">&gt; ./gradlew runServer</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then use the Muon CLI to interact with the new service, using the name <code>example-service</code> set above as it&#8217;s identifier</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">&gt; muon rpc rpc://example-service/</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see the results from the example service that should look like</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">david@patmos:~/$ muon rpc rpc://example-service/hello

┌────────────┬──────────────────────────────┬───────────────────────────────────────────────┐
│ STATUS     │ CONTENT/TYPE                 │ BODY                                          │
├────────────┼──────────────────────────────┼───────────────────────────────────────────────┤
│ <span style="color: #666666">200</span>        │ application/json             │ <span style="color: #666666">{</span><span style="color: #BA2121">&quot;Hello&quot;</span>:<span style="color: #BA2121">&quot;world 1481639846708&quot;</span><span style="color: #666666">}</span>               │
└────────────┴──────────────────────────────┴───────────────────────────────────────────────┘

<span style="color: #666666">=========</span> RESPONSE FULL BODY: <span style="color: #666666">========================================================</span>

<span style="color: #666666">{</span> Hello: <span style="color: #BA2121">&#39;world 1481639846708&#39;</span> <span style="color: #666666">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Congratulations, you have a running Muon service!</p>
</div>
</div>
<div class="sect2">
<h3 id="core-features">Core Features</h3>
<div class="sect3">
<h4 id="reactive-rpc">Reactive RPC</h4>
<div class="paragraph">
<p>Request/ Response is a well understood communication style where you make a single request and expect to receive a single resonse</p>
</div>
<div class="paragraph">
<p>Muon supports this style of communication, over it&#8217;s naturally scalable reactive and event based channel communication.</p>
</div>
<div class="sect4">
<h5 id="simple-rpc">Simple RPC</h5>
<div class="paragraph">
<p>Here is the simplest possible Muon RPC endpoint. It accepts any data pushed to it, and responsds with a simple text message</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #008000; font-weight: bold">package</span> <span style="color: #0000FF; font-weight: bold">io.muoncore.example</span><span style="color: #666666">;</span>

<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">io.muoncore.Muon</span><span style="color: #666666">;</span>

<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">java.util.concurrent.ExecutionException</span><span style="color: #666666">;</span>


<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">ReactiveRPC</span> <span style="color: #666666">{</span>

    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">exec</span><span style="color: #666666">(</span>Muon muon<span style="color: #666666">)</span> <span style="color: #008000; font-weight: bold">throws</span> ExecutionException<span style="color: #666666">,</span> InterruptedException <span style="color: #666666">{</span>

        <span style="color: #408080; font-style: italic">//request handler</span>
<span style="color: #408080; font-style: italic">//        muon.handleRequest(all(), request -&gt; {</span>
<span style="color: #408080; font-style: italic">//            request.ok(&quot;Hi There&quot;);</span>
<span style="color: #408080; font-style: italic">//        });</span>
<span style="color: #408080; font-style: italic">//</span>
<span style="color: #408080; font-style: italic">//        //request client</span>
<span style="color: #408080; font-style: italic">//        Response data = muon.request(&quot;request://myservice/&quot;).get();</span>
<span style="color: #408080; font-style: italic">//</span>
<span style="color: #408080; font-style: italic">//        System.out.println(&quot;The Data is &quot; + data.getPayload(String.class));</span>
    <span style="color: #666666">}</span>
<span style="color: #666666">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The client for this looks like</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #008000; font-weight: bold">package</span> <span style="color: #0000FF; font-weight: bold">io.muoncore.example</span><span style="color: #666666">;</span>

<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">io.muoncore.Muon</span><span style="color: #666666">;</span>

<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">java.util.concurrent.ExecutionException</span><span style="color: #666666">;</span>


<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">ReactiveRPC</span> <span style="color: #666666">{</span>

    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">exec</span><span style="color: #666666">(</span>Muon muon<span style="color: #666666">)</span> <span style="color: #008000; font-weight: bold">throws</span> ExecutionException<span style="color: #666666">,</span> InterruptedException <span style="color: #666666">{</span>

        <span style="color: #408080; font-style: italic">//request handler</span>
<span style="color: #408080; font-style: italic">//        muon.handleRequest(all(), request -&gt; {</span>
<span style="color: #408080; font-style: italic">//            request.ok(&quot;Hi There&quot;);</span>
<span style="color: #408080; font-style: italic">//        });</span>
<span style="color: #408080; font-style: italic">//</span>
<span style="color: #408080; font-style: italic">//        //request client</span>
<span style="color: #408080; font-style: italic">//        Response data = muon.request(&quot;request://myservice/&quot;).get();</span>
<span style="color: #408080; font-style: italic">//</span>
<span style="color: #408080; font-style: italic">//        System.out.println(&quot;The Data is &quot; + data.getPayload(String.class));</span>
    <span style="color: #666666">}</span>
<span style="color: #666666">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Response object contains meta data about the reponse, if it succeeded.</p>
</div>
</div>
<div class="sect4">
<h5 id="making-it-reactive">Making it Reactive</h5>
<div class="paragraph">
<p>The handler does not need to response synchronously as in the above example. The response can be invoked from any context, and by any thread.</p>
</div>
<div class="paragraph">
<p>This will cause an event to flow back down the channel and complete the request/ response cycle.</p>
</div>
<div class="paragraph">
<p>An example of this in action is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #008000; font-weight: bold">package</span> <span style="color: #0000FF; font-weight: bold">io.muoncore.example</span><span style="color: #666666">;</span>

<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">io.muoncore.Muon</span><span style="color: #666666">;</span>

<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">java.util.LinkedList</span><span style="color: #666666">;</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">java.util.concurrent.ExecutionException</span><span style="color: #666666">;</span>

<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">ReactiveRPCAsync</span> <span style="color: #666666">{</span>

    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">exec</span><span style="color: #666666">(</span>Muon muon<span style="color: #666666">)</span> <span style="color: #008000; font-weight: bold">throws</span> ExecutionException<span style="color: #666666">,</span> InterruptedException <span style="color: #666666">{</span>

<span style="color: #408080; font-style: italic">//        Queue&lt;RequestWrapper&gt; requestQueue = new LinkedList&lt;&gt;();</span>
<span style="color: #408080; font-style: italic">//</span>
<span style="color: #408080; font-style: italic">//        //request handler</span>
<span style="color: #408080; font-style: italic">//        muon.handleRequest(all(), requestQueue::add);</span>
<span style="color: #408080; font-style: italic">//</span>
<span style="color: #408080; font-style: italic">//        new Thread(() -&gt; {</span>
<span style="color: #408080; font-style: italic">//</span>
<span style="color: #408080; font-style: italic">//            while(true) {</span>
<span style="color: #408080; font-style: italic">//</span>
<span style="color: #408080; font-style: italic">//                RequestWrapper wrapper = requestQueue.poll();</span>
<span style="color: #408080; font-style: italic">//</span>
<span style="color: #408080; font-style: italic">//                wrapper.ok(&quot;Hello&quot;);</span>
<span style="color: #408080; font-style: italic">//</span>
<span style="color: #408080; font-style: italic">//                if (requestQueue.isEmpty()) {</span>
<span style="color: #408080; font-style: italic">//                    // ... wait ....</span>
<span style="color: #408080; font-style: italic">//                }</span>
<span style="color: #408080; font-style: italic">//            }</span>
<span style="color: #408080; font-style: italic">//        });</span>
<span style="color: #408080; font-style: italic">//</span>
<span style="color: #408080; font-style: italic">//        //request client</span>
<span style="color: #408080; font-style: italic">//        Response data = muon.request(&quot;request://myservice/&quot;).get();</span>
<span style="color: #408080; font-style: italic">//</span>
<span style="color: #408080; font-style: italic">//        System.out.println(&quot;The Data is &quot; + data.getPayload(String.class));</span>
    <span style="color: #666666">}</span>
<span style="color: #666666">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This demonstrates adding the requests onto a queue and processing them asynchronously.</p>
</div>
<div class="paragraph">
<p>Be aware that the request will time out on both the client and server side, depending on your configuration.</p>
</div>
</div>
<div class="sect4">
<h5 id="batch-handling-rpc">Batch handling RPC</h5>
<div class="paragraph">
<p>A common failure of RPC based systems is that they attempt to perform too much work in concurrently, and in logical isolation.
This then ends up causing thread thrashing, overwhelming of the thread pool or overload on some backing data store.</p>
</div>
<div class="paragraph">
<p>Taking the above mechanism to it&#8217;s logical conclusion, it becomes trivial to batch up the processing of request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #008000; font-weight: bold">package</span> <span style="color: #0000FF; font-weight: bold">io.muoncore.example</span><span style="color: #666666">;</span>

<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">io.muoncore.Muon</span><span style="color: #666666">;</span>

<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">java.util.LinkedList</span><span style="color: #666666">;</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">java.util.Queue</span><span style="color: #666666">;</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">java.util.concurrent.ExecutionException</span><span style="color: #666666">;</span>


<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">ReactiveRPCBatch</span> <span style="color: #666666">{</span>

    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">exec</span><span style="color: #666666">(</span>Muon muon<span style="color: #666666">)</span> <span style="color: #008000; font-weight: bold">throws</span> ExecutionException<span style="color: #666666">,</span> InterruptedException <span style="color: #666666">{</span>

<span style="color: #408080; font-style: italic">//        Queue&lt;RequestWrapper&gt; requestQueue = new LinkedList&lt;&gt;();</span>
<span style="color: #408080; font-style: italic">//</span>
<span style="color: #408080; font-style: italic">//        //request handler</span>
<span style="color: #408080; font-style: italic">//        muon.handleRequest(all(), requestQueue::add);</span>


        <span style="color: #408080; font-style: italic">//TODO, a good eaxmple of the pattern</span>


    <span style="color: #666666">}</span>
<span style="color: #666666">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example will, every 5 seconds, drain the queue, generate a single answer and send it to all of them.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reactive-streams">Reactive Streams</h4>
<div class="paragraph">
<p>Muon is built to enable the creation of streams easily. Internally everything is treated as a <em>channel</em>, a naturally streaming
construction.</p>
</div>
<div class="paragraph">
<p>This is best accessed via the Reactive Streams API, a cross industry effort to standardise streaming communication with back pressure.</p>
</div>
<div class="paragraph">
<p>To publish a new stream, create a <em>Publisher</em> and pass it into the publishStream method, giving it a name, and the semantics of the stream.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">Unresolved directive in submodules<span style="color: #666666">/</span>java<span style="color: #666666">/</span>doc<span style="color: #666666">/</span>core<span style="color: #666666">.</span><span style="color: #7D9029">adoc</span> <span style="color: #666666">-</span> include<span style="color: #666666">::</span>src<span style="color: #666666">/</span>main<span style="color: #666666">/</span>java<span style="color: #666666">/</span>io<span style="color: #666666">/</span>muoncore<span style="color: #666666">/</span>example<span style="color: #666666">/</span>ReactiveStreams<span style="color: #666666">.</span><span style="color: #7D9029">java</span><span style="color: #666666">[]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we use <em>Spring Reactor</em> to demonstrate the creation of a Publisher, however any Reactive Streams compatible framework or library could
be used.</p>
</div>
<div class="paragraph">
<p>To access the data from another service, use the subscribe method, passing in the logical Muon discovery url.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">Unresolved directive in submodules<span style="color: #666666">/</span>java<span style="color: #666666">/</span>doc<span style="color: #666666">/</span>core<span style="color: #666666">.</span><span style="color: #7D9029">adoc</span> <span style="color: #666666">-</span> include<span style="color: #666666">::</span>src<span style="color: #666666">/</span>main<span style="color: #666666">/</span>java<span style="color: #666666">/</span>io<span style="color: #666666">/</span>muoncore<span style="color: #666666">/</span>example<span style="color: #666666">/</span>ReactiveStreams<span style="color: #666666">.</span><span style="color: #7D9029">java</span><span style="color: #666666">[]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, this example uses Java and shows two separate services communicating using a reactive message stream, with back pressure support
managed by Reactor.</p>
</div>
</div>
<div class="sect3">
<h4 id="wiretap">Wiretap</h4>
<div class="paragraph">
<p>The transport subsystem of Muon injects a WiretapChannel into every connection that is made. This allows you to optionally
read the messages moving in and out of the transport and further interpret them. The messages themselves are immutable,
and so you recieve the message itself for processing.</p>
</div>
<div class="paragraph">
<p>Ordinarily, this is used to record the way a service communicates with the rest of the distributed application. This
is particularly useful when designing and building a new communication protocol.</p>
</div>
<div class="paragraph">
<p>Image a service with a single RPC endpoint that accepts an undefined object data structure, which represent using a Map.
 It then responds inline wth the number 42. A very simple service.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">        Broadcaster<span style="color: #666666">&lt;</span>String<span style="color: #666666">&gt;</span> publisher <span style="color: #666666">=</span> Broadcaster<span style="color: #666666">.</span><span style="color: #7D9029">create</span><span style="color: #666666">();</span>

<span style="color: #408080; font-style: italic">//        muon.handleRequest(all(), request -&gt; {</span>
<span style="color: #408080; font-style: italic">//            request.ok(42);</span>
<span style="color: #408080; font-style: italic">//        });</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We would like to generate a list of all the services that are calling this one, without altering the business method.</p>
</div>
<div class="paragraph">
<p>We could implement this using a wiretap, this will extract a stream of all the requests that match a particular filter.
The stream interface provided implements the Reactive Stream interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #408080; font-style: italic">//        Set&lt;String&gt; remoteServices = new HashSet&lt;&gt;();     </span><i class="conum" data-value="1"></i><b>(1)</b>
<span style="color: #408080; font-style: italic">//        Broadcaster&lt;MuonMessage&gt; requests = Broadcaster.create();</span>
<span style="color: #408080; font-style: italic">//</span>
<span style="color: #408080; font-style: italic">//        requests.consume(msg -&gt; {</span>
<span style="color: #408080; font-style: italic">//            remoteServices.add(msg.getSourceServiceName());  </span><i class="conum" data-value="2"></i><b>(2)</b>
<span style="color: #408080; font-style: italic">//        });</span>
<span style="color: #408080; font-style: italic">//</span>
<span style="color: #408080; font-style: italic">//        muon.getTransportControl().tap(                      </span><i class="conum" data-value="3"></i><b>(3)</b>
<span style="color: #408080; font-style: italic">//                msg -&gt; msg.getStep().equals(RRPEvents.REQUEST)).subscribe(requests); </span> <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The services that have connected to this one via the RPC endpont.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A Spring Reactor Broadcaster, converting the messages into the list.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Adding the tap into the Muon transport subsystem</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The filter matches for the EventType field on the TransportMessage, picking out particular messages.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Whenever you then perform an RPC communication, the Request <code><code>TransportMessage</code></code> events will be selected by your wiretap
 and passed into the Subscriber, in this case the Reactor Broadcaster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #408080; font-style: italic">//        int value = muon.request(&quot;request://myservice/&quot;).get().getPayload(Integer.class);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As many wiretaps as you like can be active. You may add another Wiretap later on to select the Response messages, and it will then begin
to receive all the messages required.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #408080; font-style: italic">//        Broadcaster&lt;MuonMessage&gt; responses = Broadcaster.create();</span>
<span style="color: #408080; font-style: italic">//</span>
<span style="color: #408080; font-style: italic">//        responses.consume(msg -&gt; {</span>
<span style="color: #408080; font-style: italic">//            System.out.println(&quot;Sent a response to &quot; + msg.getTargetServiceName());</span>
<span style="color: #408080; font-style: italic">//        });</span>
<span style="color: #408080; font-style: italic">//</span>
<span style="color: #408080; font-style: italic">//        muon.getTransportControl().tap(</span>
<span style="color: #408080; font-style: italic">//                msg -&gt; msg.getStep().equals(RRPEvents.RESPONSE)).subscribe(responses);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finish this event guide.
Write up the event guide with a concrete example</p>
</div>
<div class="paragraph">
<p>Users. regsitering, removing. Simple streaming aggregation. THen with a projection instead.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="event-based-systems">Event Based Systems</h3>
<div class="paragraph">
<p>Event based architectures have many powerful and useful properties when building distributed and scalable
systems. The Muon ecosystem provides special support for building event based systems, in the form of :=</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Microservices providing optimised event storage, transformation and query.</p>
</li>
<li>
<p>Muon protocols and APIs to interact with event based data.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Eventing in Muon is taken to mean persisted event architectures, where the streams of events are stored
and used at future points. This is often called <em>event sourcing</em>.</p>
</div>
<div class="sect3">
<h4 id="running-an-event-store">Running an Event Store</h4>
<div class="paragraph">
<p>To get started with</p>
</div>
</div>
<div class="sect3">
<h4 id="setting-up-the-event-client">Setting up the event client</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">Unresolved directive in submodules<span style="color: #666666">/</span>java<span style="color: #666666">/</span>doc<span style="color: #666666">/</span>eventsystem<span style="color: #666666">.</span><span style="color: #7D9029">adoc</span> <span style="color: #666666">-</span> include<span style="color: #666666">::</span>src<span style="color: #666666">/</span>main<span style="color: #666666">/</span>java<span style="color: #666666">/</span>io<span style="color: #666666">/</span>muoncore<span style="color: #666666">/</span>example<span style="color: #666666">/</span>event<span style="color: #666666">/</span>EventClientExample<span style="color: #666666">.</span><span style="color: #7D9029">java</span><span style="color: #666666">[</span>tags<span style="color: #666666">=</span>createclient<span style="color: #666666">]</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="emitting-events">Emitting Events</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">Unresolved directive in submodules<span style="color: #666666">/</span>java<span style="color: #666666">/</span>doc<span style="color: #666666">/</span>eventsystem<span style="color: #666666">.</span><span style="color: #7D9029">adoc</span> <span style="color: #666666">-</span> include<span style="color: #666666">::</span>src<span style="color: #666666">/</span>main<span style="color: #666666">/</span>java<span style="color: #666666">/</span>io<span style="color: #666666">/</span>muoncore<span style="color: #666666">/</span>example<span style="color: #666666">/</span>event<span style="color: #666666">/</span>EventClientExample<span style="color: #666666">.</span><span style="color: #7D9029">java</span><span style="color: #666666">[</span>tags<span style="color: #666666">=</span>emitevent<span style="color: #666666">]</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="replaying-events">Replaying Events</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">Unresolved directive in submodules<span style="color: #666666">/</span>java<span style="color: #666666">/</span>doc<span style="color: #666666">/</span>eventsystem<span style="color: #666666">.</span><span style="color: #7D9029">adoc</span> <span style="color: #666666">-</span> include<span style="color: #666666">::</span>src<span style="color: #666666">/</span>main<span style="color: #666666">/</span>java<span style="color: #666666">/</span>io<span style="color: #666666">/</span>muoncore<span style="color: #666666">/</span>example<span style="color: #666666">/</span>event<span style="color: #666666">/</span>EventClientExample<span style="color: #666666">.</span><span style="color: #7D9029">java</span><span style="color: #666666">[</span>tags<span style="color: #666666">=</span>replay<span style="color: #666666">]</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="event-sourcing">Event Sourcing</h4>
<div class="paragraph">
<p>talk about replaying data and ingesting it into some internal model for awesomeness to ensure.</p>
</div>
<div class="paragraph">
<p>TODO, link core event sourcing docs.</p>
</div>
<div class="paragraph">
<p>Apart from the recommended event store, Photon, Muon Java provides an in memory, simplified event store that only implements
 the core ingest and stream functionality of a muon compatible event store. You can read more about it <a href="InMemEventStore.html">here</a></p>
</div>
<div class="paragraph">
<p>This is most useful during building tests.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-event-projections">Using Event Projections</h4>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="extending-muon-java">Extending Muon Java</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In common with all Muon libraries, Muon Java is a restricted implementation of Communicating Sequential Processes.
Extension then mostly involves creating and exposing various combinations of processes and channels.</p>
</div>
<div class="sect2">
<h3 id="encoding">Encoding</h3>

</div>
<div class="sect2">
<h3 id="transports">Transports</h3>

</div>
<div class="sect2">
<h3 id="discovery">Discovery</h3>

</div>
<div class="sect2">
<h3 id="adding-a-new-interaction-protocol">Adding a new interaction protocol</h3>
<div class="paragraph">
<p>Before reading on, many systems won&#8217;t need to do this. The baked in protocols (RPC, Streaming etc) are generally good enough
in most circumstances. If you do have a specific need to control the way your services interact in a more granular way then read on!</p>
</div>
<div class="paragraph">
<p>To implement a new protocol, you need to define the API(s) that you want to provide to your users, define the event interchange
that will need to happen to communicate that between services, and then create the processes need to bring those events to life.</p>
</div>
<div class="paragraph">
<p>This guide focuses on how to implement this in Muon-Java. For a fuller discussion on event protocols, see the main guide.</p>
</div>
<div class="paragraph">
<p>TODO, link to main guide on protocols</p>
</div>
<div class="sect3">
<h4 id="designing-a-protocol">Designing a Protocol</h4>

</div>
<div class="sect3">
<h4 id="client-side">Client Side</h4>
<div class="sect4">
<h5 id="designing-building-a-muon-client-process">Designing Building a Muon Client Process</h5>

</div>
<div class="sect4">
<h5 id="designing-the-user-api-and-protocol-stack">Designing the User API and Protocol Stack</h5>

</div>
</div>
<div class="sect3">
<h4 id="server-side">Server Side</h4>
<div class="sect4">
<h5 id="designing-building-a-muon-server-process">Designing Building a Muon Server Process</h5>

</div>
<div class="sect4">
<h5 id="registering-the-serverstack">Registering the ServerStack</h5>

</div>
</div>
</div>
</div>
</div>
        </div>
      </div>

      <div class='four spacing'></div>
    </div>
  </div>
</div>
</div>

    </div>

    

  <!--End mc_embed_signup-->
<div class='full no-padding' style='background: #111'>
  <div class='two spacing'></div>
  <div class='row'>
    <div class='large-12 columns' style="color:white;">
      <p>©2017 Muon Core Ltd. All rights reserved.</p>
    </div>
  </div>
  <div class='spacing'></div>
</div>


<script src="/javascripts/jquery.countTo.js" type="text/javascript"></script>
<script src="/javascripts/jquery.appear.js" type="text/javascript"></script>
<script src="/javascripts/jquery.validate.js" type="text/javascript"></script>
<script src="/javascripts/jquery.sequence-min.js" type="text/javascript"></script>
<script src="/javascripts/jquery.easing.1.3.js" type="text/javascript"></script>
<script src="/javascripts/app.js" type="text/javascript"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-75338923-1', 'auto');
  ga('require', 'linkid');
  ga('send', 'pageview');

</script>


  </body>

</html>
