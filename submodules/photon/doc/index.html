<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Muon - Reactive APIs</title>
  <meta name="description" content="">

    <link rel="stylesheet" href="/css/foundation.css">

    <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/fontello.css">
  <link rel="stylesheet" href="/css/font-awesome.css">
  <script src="/javascripts/modernizr.foundation.js" type="text/javascript"></script>
    <script src="/javascripts/jquery-2.1.0.js" type="text/javascript"></script>
    <script src="/javascripts/terrific-1.1.1.js" type="text/javascript"></script>
    <script src="/javascripts/jquery.url.js" type="text/javascript"></script>
    <script src="/javascripts/jquery.cookie.js" type="text/javascript"></script>
    <script src="/javascripts/json2.js" type="text/javascript"></script>
    <script src="/javascripts/foundation.js" type="text/javascript"></script>
  <script>
    // terrificjs bootstrap
    (function($) {
        $(document).ready(function() {
            var $page = $('body');
            var config = {
              dependencyPath: {
                plugin: 'javascripts/'
              }
            }
            var application = new Tc.Application($page, config);
            application.registerModules();
            application.start();
        });
    })(Tc.$);
  </script>
  <link href="http://fonts.googleapis.com/css?family=Raleway:400,700,300" media="screen" rel="stylesheet" type="text/css" />
  <script src="/javascripts/masonry.pkgd.js" type="text/javascript"></script>
  <script src="/javascripts/imagesloaded.pkgd.min.js" type="text/javascript"></script>
  <script src="/javascripts/slick.min.js" type="text/javascript"></script>

  <link rel="canonical" href="/submodules/photon/doc/">
  <link rel="alternate" type="application/rss+xml" title="Muon - Reactive APIs" href="/feed.xml" />
  <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
          <link rel="stylesheet" href="/css/asciidoc.css">
          <link rel="stylesheet" href="/css/producttable.css">
                  <style>
  @media only screen and (min-width:768px){#toctitle{font-size:1.375em}
      body.toc2{padding-left:15em;padding-right:0}
#toc {margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;right:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc >ul{font-size:.9em;margin-bottom:0}
#toc ul ul{margin-left:0;padding-left:1em}
#toc ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
  @media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc {width:20em}
#toc #toctitle{font-size:1.375em}
#toc >ul{font-size:.95em}
#toc ul ul{padding-left:1.25em}
      body.toc2.toc-right{padding-left:0;padding-right:20em}}

#toc { z-index:20; padding-top:120px;}
#documentation { padding-left:10px; margin-left:auto; margin-right:auto}
#documentation .row { margin:auto }
      code {
          background:none;
          border:0;
      }

      code span { border: 0; width:100% }
      .listingblock {
         background: #eee;
         border-radius:5px;
          border:1px solid #ccc
      }
  }

  div.documentation a.btn {
    margin-top:20px;
    background: #3498db;
    background-image: -webkit-linear-gradient(top, #3498db, #2980b9);
    background-image: -moz-linear-gradient(top, #3498db, #2980b9);
    background-image: -ms-linear-gradient(top, #3498db, #2980b9);
    background-image: -o-linear-gradient(top, #3498db, #2980b9);
    background-image: linear-gradient(to bottom, #3498db, #2980b9);
    -webkit-border-radius: 28;
    -moz-border-radius: 28;
    border-radius: 28px;
    font-family: Arial;
    color: #ffffff;
    font-size: 20px;
    padding: 10px 20px 10px 20px;
    text-decoration: none;
  }

  div.documentation a.btn:hover {
    background: #3cb0fd;
    background-image: -webkit-linear-gradient(top, #3cb0fd, #3498db);
    background-image: -moz-linear-gradient(top, #3cb0fd, #3498db);
    background-image: -ms-linear-gradient(top, #3cb0fd, #3498db);
    background-image: -o-linear-gradient(top, #3cb0fd, #3498db);
    background-image: linear-gradient(to bottom, #3cb0fd, #3498db);
    text-decoration: none;
  }

  </style>

  <link rel="stylesheet" href="/css/sidebar2.css">
</head>


  <body>
    
      <a id='top'></a>
<div class='contain-to-grid sticky fullwidth'>
  <nav class='top-bar onepage' data-options='sticky_on: large' data-topbar=''>
    <ul class='title-area'>
      <li class='name'>
        <h1>
          <a href="/">
            <img alt="" src="/images/muonlogo.png" style="width:50px; height:50px" /> Muon
          </a>
        </h1>
      </li>
      <li class='toggle-topbar menu-icon'>
        <a href='#'>Menu</a>
      </li>
    </ul>
    <span style="float:left">Reactive APIs for Microservices, Browser and More ...</span>
    <section class='top-bar-section'>
      <ul class='right'>
        
          
            <li>
              
                <a href="guide/index.html">Guides</a>
              

            </li>
          
        
          
            <li class="has-dropdown">
              <a href="/guide/index.html">Docs</a>
              <ul class='dropdown'>
                
                  <li>
                    <a href="/guide/index.html">Guides</a>
                  </li>
                
                  <li>
                    <a href="/submodules/cli/doc/index.html">CLI</a>
                  </li>
                
                  <li>
                    <a href="/submodules/java/doc/">Java</a>
                  </li>
                
                  <li>
                    <a href="/submodules/clojure/doc/index.html">Clojure</a>
                  </li>
                
                  <li>
                    <a href="/submodules/node/doc/index.html">Node.JS</a>
                  </li>
                
                  <li>
                    <a href="/submodules/muonjs/doc/index.html">Browser</a>
                  </li>
                
                  <li>
                    <a href="/submodules/photon/doc/index.html">Photon - Event Store</a>
                  </li>
                
              </ul>
            </li>
          
        
          
            <li>
              
                <a href="https://github.com/muoncore">Github</a>
              

            </li>
          
        
      </ul>
    </section>
  </nav>
</div>
<div class='full no-padding'>
  <!-- Begin MailChimp Signup Form -->
  <link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
  <style type="text/css">
    #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
    /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
         We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
  </style>
  <div id="mc_embed_signup">
    <form action="//simplicityitself.us9.list-manage.com/subscribe/post?u=fce1e12e8f44592cf75288e11&amp;id=98e2ce96d8" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
      <div id="mc_embed_signup_scroll">
        <label for="mce-EMAIL">Get updated on new releases and features</label>
        <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_fce1e12e8f44592cf75288e11_98e2ce96d8" tabindex="-1" value=""></div>
        <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
      </div>
    </form>
  </div>
</div>

    

    <div id='main' role='main'>
      <div class="documentation">
<div class='full' style='background: #000'>
  <div class='row' style="margin-left:0; margin-right:0; max-width:100%">
    <div class='large-12 columns'>
      <div class='mod modBlogPost big'>
        <div class='images'>
          
        </div>
        <div class='content' style="font-size:1.2rem; max-width:80%">
          <div id="toc" class="toc">
<div id="toctitle">Photon</div>
<ul class="sectlevel1">
<li><a href="#photon">Photon</a>
<ul class="sectlevel2">
<li><a href="#quickstart">Quickstart</a></li>
</ul>
</li>
<li><a href="#muon-events">Muon Events</a>
<ul class="sectlevel2">
<li><a href="#streams">Streams</a>
<ul class="sectlevel3">
<li><a href="#replay">Replay</a></li>
<li><a href="#partial-replay">Partial Replay</a></li>
<li><a href="#internal-streams">Internal Streams</a>
<ul class="sectlevel4">
<li><a href="#__config__">__config__</a></li>
<li><a href="#__all__">__all__</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#projections">Projections</a>
<ul class="sectlevel3">
<li><a href="#creating">Creating</a></li>
<li><a href="#querying">Querying</a></li>
<li><a href="#deleting">Deleting</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#operations">Operations</a>
<ul class="sectlevel2">
<li><a href="#installation">Installation</a></li>
<li><a href="#startup-options">Startup options</a></li>
<li><a href="#setting-up-a-file-for-static-configuration">Setting up a file for static configuration</a>
<ul class="sectlevel3">
<li><a href="#running-in-a-docker-based-system">Running in a Docker based system</a></li>
</ul>
</li>
<li><a href="#backup">Backup</a>
<ul class="sectlevel3">
<li><a href="#copy-backing-data-store">Copy backing data store</a></li>
<li><a href="#stream-based">Stream based</a></li>
</ul>
</li>
<li><a href="#monitoring">Monitoring</a></li>
</ul>
</li>
<li><a href="#backing-data-stores">Backing data stores</a>
<ul class="sectlevel2">
<li><a href="#embedded-h2">Embedded H2</a></li>
<li><a href="#cassandra">Cassandra</a></li>
<li><a href="#mongodb">MongoDB</a></li>
</ul>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unresolved directive in index.adoc - include::submodules/photon/docs/version.adoc[leveloffset=+1]</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This document is maintained at <a href="https://github.com/muoncore/photon" class="bare">https://github.com/muoncore/photon</a>.
Please submit issues at that repository.
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="photon">Photon</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Muon is designed to enable the construction and expression of distributed programming models,
 especially those following Reactive principles.</p>
</div>
<div class="paragraph">
<p>Event Systems are a very important and flexible programming model, especially when paired with the
Event Sourcing approach designed by Greg Young, which you can read about <a href="http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/">here</a></p>
</div>
<div class="paragraph">
<p>Photon provides stream persistence and data analysis functionality that, along with the Event Client protocol
in the Muon libraries, enables you to implement Events, Event Sourcing and CQRS within a Muon system</p>
</div>
<div class="sect2">
<h3 id="quickstart">Quickstart</h3>
<div class="paragraph">
<p>Download the <a href="https://github.com/muoncore/muon-starter">Muon Starter</a> repository and run through the instructions and
pre-requisites from there. The latest released version of photon will be started using Docker Compose,
along with a contained RabbitMQ instance for communication and other support microservices.</p>
</div>
<div class="paragraph">
<p>Install the <a href="https://github.com/muoncore/muon-cli">Muon CLI</a> and set up with the URL <code>amqp://muon:microservices@localhost</code></p>
</div>
<div class="paragraph">
<p>You can then see photon running</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">&gt; muon d

┌──────────────────────────────┬──────────────────────────────┬──────────────────────────────┐
│ SERVICE NAME                 │ TAGS                         │ CONTENT/TYPE                 │
├──────────────────────────────┼──────────────────────────────┼──────────────────────────────┤
│ molecule                     │                              │ application/json             │
├──────────────────────────────┼──────────────────────────────┼──────────────────────────────┤
│ photon                       │ photon,eventstore            │ application/json             │
└──────────────────────────────┴──────────────────────────────┴──────────────────────────────┘</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can emit an event using the CLI</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">&gt; muon emit <span style="color: #BA2121">&#39;{ &quot;event-type&quot;: &quot;SomethingHappened&quot;, &quot;schema&quot;: &quot;1&quot;,&quot;stream-name&quot;: &quot;something&quot;,&quot;payload&quot;: {&quot;message&quot;: &quot;Hi there!&quot;}}&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This will persist the event in the given stream. It can be replayed at any point later on</p>
</div>
<div class="paragraph">
<p>You can replay the persisted events using the CLI</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">&gt; muon replay something</code></pre>
</div>
</div>
<div class="paragraph">
<p>All the events stored will then be replayed.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="muon-events">Muon Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Muon Events is a set of protocols and services (most notably, <strong>Photon</strong>), that enable the easy
use of Events, Event Sourcing and Event Projections/ Aggregations in creating distributed applications</p>
</div>
<div class="paragraph">
<p>This section describes how you can develop using these concepts.</p>
</div>
<div class="paragraph">
<p>See the <a href="/guide/index.html">Muon Guide</a> for more information on using these patterns</p>
</div>
<div class="sect2">
<h3 id="streams">Streams</h3>
<div class="paragraph">
<p>The central concept in Muon Events, and so Photon, is the <em>stream</em>. This is a set of <em>Events</em> that
have occurred, persisted in the order they happened.</p>
</div>
<div id="streams" class="imageblock">
<div class="content">
<img src="images/streams.png" alt="Streams">
</div>
<div class="title">Figure 1. Streams in Photon</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Events</div>
<div class="paragraph">
<p>Events are <em>things that have happened</em>. They are the <em>facts</em> of your system, that you can use to derive the <em>current state</em></p>
</div>
<div class="paragraph">
<p>Muon Events generally expects that events are durable, which is what Photon will do for you.</p>
</div>
<div class="paragraph">
<p>Every Event should contain the following information</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>What Happened</strong> - The event type.</p>
</li>
<li>
<p><strong>When it Happened</strong> - the event time.</p>
</li>
<li>
<p>A description of the change, the event payload</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Muon Events also gives the option to include</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Why it happened</strong> - the causing event id</p>
</li>
<li>
<p><strong>Who caused it</strong> - the service that emitted the event</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Photon persists all of this information, and allows you to replay and as you see later, project that
data into representations you can use in your applications.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="replay">Replay</h4>
<div class="paragraph">
<p>Streams can be replayed using the Reactive Streams protocol.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">&gt; muon replay mystream</code></pre>
</div>
</div>
<div class="paragraph">
<p>This connects to photon using the <em>Reactive Streams Protocol</em>, and creates a subscription to the
logical stream you have requested.</p>
</div>
<div class="paragraph">
<p>The default replay mode is 'hot-cold', where all of the historical events will be replayed, then
 all new data will continue to be played, including everything in the future. This subscription
 will never <strong>complete</strong> by itself, it remains open until the client closes it.</p>
</div>
<div id="streams" class="imageblock">
<div class="content">
<img src="images/streams-replay.png" alt="Stream Replay">
</div>
<div class="title">Figure 2. Stream Replay</div>
</div>
</div>
<div class="sect3">
<h4 id="partial-replay">Partial Replay</h4>
<div class="paragraph">
<p>TODO, describe how to play from an order-id or timestamp</p>
</div>
</div>
<div class="sect3">
<h4 id="internal-streams">Internal Streams</h4>
<div class="paragraph">
<p>Photon persists everything as streams, including its own data structures.</p>
</div>
<div class="paragraph">
<p>The streams internal to Photon have a __ prefix/ suffix.</p>
</div>
<div class="paragraph">
<p>You can replay data from these internal streams, and they are useful for creating backups of Photon state.</p>
</div>
<div class="paragraph">
<p>In a future version of Photon, these streams will form the basis for a feature called <em>Federation</em>, complex, multi node installations.</p>
</div>
<div class="sect4">
<h5 id="__config__">__config__</h5>
<div class="paragraph">
<p>Photon internal configuration is stored in the __config__ stream. Internally, this stream is played into a data structure
that represents the current Photon configuration.</p>
</div>
<div class="paragraph">
<p>The Photon API layer acts as a front on this stream.</p>
</div>
</div>
<div class="sect4">
<h5 id="__all__">__all__</h5>
<div class="paragraph">
<p>The second special stream is __all__. This contains all events, on all streams.</p>
</div>
<div class="paragraph">
<p>You can play this to obtain all events ever recieved by photon, in the order they were added in, no matter which stream, using
the global order_id.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="projections">Projections</h3>
<div class="paragraph">
<p>A very common pattern when dealing with stream based systems is aggregating the stream into a state
representation. This goes by many names, but is fundamentally the <em>reduce</em> from the the well known
<em>map/ reduce</em> pattern.</p>
</div>
<div class="paragraph">
<p>In this pattern, using a stateless function, you incrementally build a data structure by running the elements of
 the stream through the function. The function receives the current state, the event to process, and returns the new state.</p>
</div>
<div class="paragraph">
<p>This is such a common pattern that Photon has support this feature built in, known as stream <strong><em>Projections</em></strong>.</p>
</div>
<div class="sect3">
<h4 id="creating">Creating</h4>

</div>
<div class="sect3">
<h4 id="querying">Querying</h4>

</div>
<div class="sect3">
<h4 id="deleting">Deleting</h4>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="operations">Operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Photon is designed to be lightweight when it comes to operational maintenance.</p>
</div>
<div class="paragraph">
<p>It is, however, a stateful component, and so that state needs to be looked after.</p>
</div>
<div class="sect2">
<h3 id="installation">Installation</h3>
<div class="paragraph">
<p>Photon is distributed as an uberjar and as a Docker image.</p>
</div>
</div>
<div class="sect2">
<h3 id="startup-options">Startup options</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>Usage: java -jar photon-x.x.x-standalone.jar [-h] [-option value] ... [-option value]
Options:
-microservice.name    : Service ID, especially important for Muon (default = photon)
-rest.host            : The IP or hostname of the web server for frontend and API. Change it for external access (default = localhost)
-rest.port            : The port for the UI frontend and the REST API
-rest.keystore        : If set, the web server will be started in SSL mode using the certificates identified by this path
-rest.keypass         : The password required to open the keystore set in rest.keystore. Not required in not-SSL mode
-admin.user           : The default username for logging in and requesting API tokens (default = admin)
-admin.pass           : The default password for logging in and requesting API tokens (default = p4010n)
-admin.secret         : A secret string that will be used to encode authentication tokens (default is random on launch)
-projections.port     : Port to stream projection updates to (default = 8375)
-events.port          : Port to stream incoming events to (default = 8376)
-muon.url             : AMQP endpoint for Muon-based transport and discovery (default = amqp://localhost)
-parallel.projections : Number of cores assigned for parallel stream processing (default = number of cores on your machine)
-projections.path     : Local folder with projections, in EDN format, to pre-load on start (default = /tmp/photon)
-db.backend           : DB backend plugin to use (default=h2). Depending on the build of photon, this can be one of:
                        h2, cassandra, redis, file, mongo, riak, dummy.
-h2.path              : If using H2, the file prefix for the database file, including path (default = /tmp/photon.h2)
-cassandra.ip         : If using Cassandra, the host of the cluster
-file.path            : If using files as backend, the absolute path to the file
-mongodb.host         : If using MongoDB, the host of the cluster
-riak.default_bucket  : If using Riak, the name of the bucket
-riak.node.X          : If using Riak, the nodes that form the cluster (riak.node.1, riak.node.2, etc.)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="setting-up-a-file-for-static-configuration">Setting up a file for static configuration</h3>
<div class="paragraph">
<p>Photon can be configured either directly from the command line or from a file, and parameters can be combined from different sources. The order of priority in which the configuration is build is the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Command-line arguments</p>
</li>
<li>
<p>photon.properties in the working directory</p>
</li>
<li>
<p>resources/photon.properties</p>
</li>
<li>
<p>resources/config.properties</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Example of property file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code># Microservice identifier (default = photon):
microservice.name=photon
# AMQP endpoint (default = amqp://localhost):
muon.url=amqp://username:password@localhost
# Number of cores assigned for parallel stream processing
# (default = number of cores on your machine):
parallel.projections=8
# Local folder with projections, in EDN format, to pre-load on start
# (default = /tmp/photon):
file.path=/path/to/edn-files/
# DB backend plugin to use, several options currently available:
db.backend={file,mongodb,riak,cassandra}
# Depending on the backend, you'll need to set up the DB plugin:
cassandra.ip=127.0.0.1
file.path=/path/to/file.json
mongodb.host=localhost
riak.default_bucket=photon-eventstore-v1
riak.node.1=riak1.yourdomain.com
riak.node.2=riak2.yourdomain.com
riak.node.3=riak3.yourdomain.com</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="running-in-a-docker-based-system">Running in a Docker based system</h4>
<div class="paragraph">
<p>This includes Docker itself and related projects (compose, machine etc), and also in systems that can use Docker containers,
such as Kubernetes, Mesos and the like.</p>
</div>
<div class="paragraph">
<p>Photon is published to an Artifactory backed Docker registry.</p>
</div>
<div class="paragraph">
<p>The coordinates for the image is <code>simplicityitself-muon-image.jfrog.io/photon:latest</code></p>
</div>
<div class="paragraph">
<p>You can set the configuration options by altering the command line to be used.</p>
</div>
<div class="paragraph">
<p>You set the variable MUON_URL to the correct location for your system to enable Photon to connect to the Muon network.</p>
</div>
<div class="paragraph">
<p>This Docker Compose snippet shows how this can be done.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml">    photon:
    image: simplicityitself-muon-image.jfrog.io/photon
    environment:
      - MUON_URL=amqp://muon:microservices@rabbitmq
    links:
      - rabbitmq
    ports:
      - <span style="color: #BA2121">&quot;3000:3000&quot;</span>
    expose:
      - <span style="color: #BA2121">&quot;3000&quot;</span>
    command: -jar target/photon.jar -rest.host 0.0.0.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>This updates photon to listen for HTTP traffic on all network interfaces.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="backup">Backup</h3>
<div class="paragraph">
<p>Photon is internally fully event sourced. All changes in internal state are mediated via one of the internal streams (denoted with __XX__)</p>
</div>
<div class="paragraph">
<p>You can perform a backup in one of two ways.</p>
</div>
<div class="sect3">
<h4 id="copy-backing-data-store">Copy backing data store</h4>
<div class="paragraph">
<p>The backing data store (H2, Cassandra etc) contains all information necessary to back up the system. The data store, such as the
h2 db file, can be copied and archived to create a usable backup.</p>
</div>
<div class="paragraph">
<p>The contents of the backing data store are kept compatible over <strong>minor</strong> version updates only, and may not be compatible over major versions.</p>
</div>
</div>
<div class="sect3">
<h4 id="stream-based">Stream based</h4>
<div class="paragraph">
<p>The stream __all__ contains all of the configuration updates made over the lifetime of the system, along with all of the data
that it has persisted.</p>
</div>
<div class="paragraph">
<p>You can instruct photon to replay this stream in its entirety and persist this to disk. Once it has done so, you can
use that file to recreate a runtime clone of the original Photon.</p>
</div>
<div class="paragraph">
<p>This method is fully portable, and will be compatible over major version upgrades of Photon.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">&gt; muon replay __all__ <span style="color: #BA2121">&#39;{&quot;stream-type&quot;:&quot;cold&quot;}&#39;</span> &gt;&gt; /tmp/backup</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a log file that contains all events in the Photon.</p>
</div>
<div class="paragraph">
<p>To restore from this file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">&gt; cat /tmp/backup | muon event</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="monitoring">Monitoring</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="backing-data-stores">Backing data stores</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Photon persists streams into a variety of different data stores, provided by internal persistence plugins.</p>
</div>
<div class="paragraph">
<p>The default docker image provided uses the embedded H2 plugin, which persists to the container local disk.</p>
</div>
<div class="sect2">
<h3 id="embedded-h2">Embedded H2</h3>

</div>
<div class="sect2">
<h3 id="cassandra">Cassandra</h3>

</div>
<div class="sect2">
<h3 id="mongodb">MongoDB</h3>

</div>
</div>
</div>
        </div>
      </div>

      <div class='four spacing'></div>
    </div>
  </div>
</div>
</div>

    </div>

    

  <!--End mc_embed_signup-->
<div class='full no-padding' style='background: #111'>
  <div class='two spacing'></div>
  <div class='row'>
    <div class='large-12 columns' style="color:white;">
      <p>©2017 Muon Core Ltd. All rights reserved.</p>
    </div>
  </div>
  <div class='spacing'></div>
</div>


<script src="/javascripts/jquery.countTo.js" type="text/javascript"></script>
<script src="/javascripts/jquery.appear.js" type="text/javascript"></script>
<script src="/javascripts/jquery.validate.js" type="text/javascript"></script>
<script src="/javascripts/jquery.sequence-min.js" type="text/javascript"></script>
<script src="/javascripts/jquery.easing.1.3.js" type="text/javascript"></script>
<script src="/javascripts/app.js" type="text/javascript"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-75338923-1', 'auto');
  ga('require', 'linkid');
  ga('send', 'pageview');

</script>


  </body>

</html>
