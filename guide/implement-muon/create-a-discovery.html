<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Create a discovery</title>
  <meta name="description" content="">

    <link rel="stylesheet" href="/css/foundation.css">

    <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/fontello.css">
  <link rel="stylesheet" href="/css/font-awesome.css">
  <script src="/javascripts/modernizr.foundation.js" type="text/javascript"></script>
    <script src="/javascripts/jquery-2.1.0.js" type="text/javascript"></script>
    <script src="/javascripts/terrific-1.1.1.js" type="text/javascript"></script>
    <script src="/javascripts/jquery.url.js" type="text/javascript"></script>
    <script src="/javascripts/jquery.cookie.js" type="text/javascript"></script>
    <script src="/javascripts/json2.js" type="text/javascript"></script>
    <script src="/javascripts/foundation.js" type="text/javascript"></script>
  <script>
    // terrificjs bootstrap
    (function($) {
        $(document).ready(function() {
            var $page = $('body');
            var config = {
              dependencyPath: {
                plugin: 'javascripts/'
              }
            }
            var application = new Tc.Application($page, config);
            application.registerModules();
            application.start();
        });
    })(Tc.$);
  </script>
  <link href="http://fonts.googleapis.com/css?family=Raleway:400,700,300" media="screen" rel="stylesheet" type="text/css" />
  <script src="/javascripts/masonry.pkgd.js" type="text/javascript"></script>
  <script src="/javascripts/imagesloaded.pkgd.min.js" type="text/javascript"></script>
  <script src="/javascripts/slick.min.js" type="text/javascript"></script>

  <link rel="canonical" href="/guide/implement-muon/create-a-discovery.html">
  <link rel="alternate" type="application/rss+xml" title="Muon - Reactive APIs" href="/feed.xml" />
  <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
          <link rel="stylesheet" href="/css/asciidoc.css">
          <link rel="stylesheet" href="/css/producttable.css">
                  <style>
  @media only screen and (min-width:768px){#toctitle{font-size:1.375em}
      body.toc2{padding-left:15em;padding-right:0}
#toc {margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;right:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc >ul{font-size:.9em;margin-bottom:0}
#toc ul ul{margin-left:0;padding-left:1em}
#toc ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
  @media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc {width:20em}
#toc #toctitle{font-size:1.375em}
#toc >ul{font-size:.95em}
#toc ul ul{padding-left:1.25em}
      body.toc2.toc-right{padding-left:0;padding-right:20em}}

#toc { z-index:20; padding-top:120px;}
#documentation { padding-left:10px; margin-left:auto; margin-right:auto}
#documentation .row { margin:auto }
      code {
          background:none;
          border:0;
      }

      code span { border: 0; width:100% }
      .listingblock {
         background: #eee;
         border-radius:5px;
          border:1px solid #ccc
      }
  }

  div.documentation a.btn {
    margin-top:20px;
    background: #3498db;
    background-image: -webkit-linear-gradient(top, #3498db, #2980b9);
    background-image: -moz-linear-gradient(top, #3498db, #2980b9);
    background-image: -ms-linear-gradient(top, #3498db, #2980b9);
    background-image: -o-linear-gradient(top, #3498db, #2980b9);
    background-image: linear-gradient(to bottom, #3498db, #2980b9);
    -webkit-border-radius: 28;
    -moz-border-radius: 28;
    border-radius: 28px;
    font-family: Arial;
    color: #ffffff;
    font-size: 20px;
    padding: 10px 20px 10px 20px;
    text-decoration: none;
  }

  div.documentation a.btn:hover {
    background: #3cb0fd;
    background-image: -webkit-linear-gradient(top, #3cb0fd, #3498db);
    background-image: -moz-linear-gradient(top, #3cb0fd, #3498db);
    background-image: -ms-linear-gradient(top, #3cb0fd, #3498db);
    background-image: -o-linear-gradient(top, #3cb0fd, #3498db);
    background-image: linear-gradient(to bottom, #3cb0fd, #3498db);
    text-decoration: none;
  }

  </style>

  <link rel="stylesheet" href="/css/sidebar2.css">
</head>


  <body>
    
      <a id='top'></a>
<div class='contain-to-grid sticky fullwidth'>
  <nav class='top-bar onepage' data-options='sticky_on: large' data-topbar=''>
    <ul class='title-area'>
      <li class='name'>
        <h1>
          <a href="/">
            <img alt="" src="/images/muonlogo.png" style="width:50px; height:50px" /> Muon
          </a>
        </h1>
      </li>
      <li class='toggle-topbar menu-icon'>
        <a href='#'>Menu</a>
      </li>
    </ul>
    <span style="float:left">Reactive APIs for Microservices, Browser and More ...</span>
    <section class='top-bar-section'>
      <ul class='right'>
        
          
            <li>
              
                <a href="guide/index.html">Guides</a>
              

            </li>
          
        
          
            <li class="has-dropdown">
              <a href="/guide/index.html">Docs</a>
              <ul class='dropdown'>
                
                  <li>
                    <a href="/guide/index.html">Guides</a>
                  </li>
                
                  <li>
                    <a href="/submodules/cli/doc/index.html">CLI</a>
                  </li>
                
                  <li>
                    <a href="/submodules/java/doc/">Java</a>
                  </li>
                
                  <li>
                    <a href="/submodules/clojure/doc/index.html">Clojure</a>
                  </li>
                
                  <li>
                    <a href="/submodules/node/doc/index.html">Node.JS</a>
                  </li>
                
                  <li>
                    <a href="/submodules/muonjs/doc/index.html">Browser</a>
                  </li>
                
                  <li>
                    <a href="/submodules/photon/doc/index.html">Photon - Event Store</a>
                  </li>
                
              </ul>
            </li>
          
        
          
            <li>
              
                <a href="https://github.com/muoncore">Github</a>
              

            </li>
          
        
      </ul>
    </section>
  </nav>
</div>
<div class='full no-padding'>
  <!-- Begin MailChimp Signup Form -->
  <link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
  <style type="text/css">
    #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
    /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
         We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
  </style>
  <div id="mc_embed_signup">
    <form action="//simplicityitself.us9.list-manage.com/subscribe/post?u=fce1e12e8f44592cf75288e11&amp;id=98e2ce96d8" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
      <div id="mc_embed_signup_scroll">
        <label for="mce-EMAIL">Get updated on new releases and features</label>
        <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_fce1e12e8f44592cf75288e11_98e2ce96d8" tabindex="-1" value=""></div>
        <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
      </div>
    </form>
  </div>
</div>

    

    <div id='main' role='main'>
      <div class="documentation">
<div class='full' style='background: #000'>
  <div class='row' style="margin-left:0; margin-right:0; max-width:100%">
    <div class='large-12 columns'>
      <div class='mod modBlogPost big'>
        <div class='images'>
          
        </div>
        <div class='content' style="font-size:1.2rem; max-width:80%">
          <div id="toc" class="toc">
<div id="toctitle">Create a discovery</div>
<ul class="sectlevel1">
<li><a href="#create-a-new-muon-discovery">Create a new Muon Discovery</a>
<ul class="sectlevel2">
<li><a href="#discovery-concepts">Discovery Concepts</a>
<ul class="sectlevel3">
<li><a href="#service-name">Service Name</a></li>
<li><a href="#service-descriptor">Service Descriptor</a></li>
<li><a href="#future-extension-instance-descriptors">Future extension - instance descriptors</a></li>
</ul>
</li>
<li><a href="#create-a-discovery-for-muon-core-java">Create a Discovery for Muon Core Java</a></li>
<li><a href="#create-a-discovery-for-muon-core-node">Create a Discovery for Muon Core Node</a></li>
<li><a href="#create-a-discovery-as-a-native-library-for-java-node-future-muon">Create a Discovery as a Native Library for Java/ Node/ Future Muon</a></li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="create-a-new-muon-discovery">Create a new Muon Discovery</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A Muon Discovery is intended to allow a running Muon instance to be able to find other Muon services and obtain connection from them. How this is implemented is up to you.</p>
</div>
<div class="paragraph">
<p>There are two core functions of a Discovery</p>
</div>
<div class="ulist">
<ul>
<li>
<p>take a logical service name and obtain the service descriptor for it, if it can be found</p>
</li>
<li>
<p>Find services that match a given set of tags and return a list of their descriptors.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="discovery-concepts">Discovery Concepts</h3>
<div class="sect3">
<h4 id="service-name">Service Name</h4>
<div class="paragraph">
<p>The service name is the logical name of the service yu want to connect to. Most commonly, you will include the service name when calling an API provided by a Protocol Stack. The stack will then use that name when sending messages into muon core, which then uses the Discovery to select the appropriate transport and route messages to the remote service</p>
</div>
<div class="paragraph">
<p>The Discovery system is used in a variety of places within Muon.  It can be used within the Protocol stack to lookup services dynamically (such as by the <a href="https://github.com/muoncore/stack-event">Event Stack</a> to select the appropriate event store), or within a Transport to obtain more detailed information on a remote service to connect to it 9such as in the <a href="https://github.com/muoncore/muon-amqp">AMQP Transport</a> to select the broker to connect to)</p>
</div>
<div class="paragraph">
<p>When implementing a Discovery, you do not need to be aware of the precise usage, simply trading service descriptors is all that is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="service-descriptor">Service Descriptor</h4>
<div class="paragraph">
<p>The service descriptor provides a run down of the base information needed to identify and connect to a remote service.</p>
</div>
<div class="paragraph">
<p>Here is an example descriptor</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript">{
    <span style="color: #BA2121">&quot;serviceName&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;photonlite&quot;</span>,  <i class="conum" data-value="1"></i><b>(1)</b>
    <span style="color: #BA2121">&quot;tags&quot;</span><span style="color: #666666">:</span> [                     <i class="conum" data-value="2"></i><b>(2)</b>
      <span style="color: #BA2121">&quot;eventstore&quot;</span>
    ],
    <span style="color: #BA2121">&quot;transports&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;amqp://muon:microservices@localhost&quot;</span>  <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The logical service name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The tags associated with this service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The transports configured for the service, in the form of a URL, provided by a <code>Transport</code>. Used to connect to the service.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can obtain these in your system by running <code>muon discover --raw | jq</code></p>
</div>
</div>
<div class="sect3">
<h4 id="future-extension-instance-descriptors">Future extension - instance descriptors</h4>
<div class="paragraph">
<p>Muon Core is currently being extended to obtain and use specific instance information, allowing multiple services to have the same service name, but be addressed individually if required.</p>
</div>
<div class="paragraph">
<p>Your discovery should maintain lists of instances internally and return one as the service in order to support this extension in the future.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-a-discovery-for-muon-core-java">Create a Discovery for Muon Core Java</h3>
<div class="paragraph">
<p>A discovery in muon java extends the <code>Discovery</code> interface. At minimum, this needs to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>List the names of the services in the system (full set)</p>
</li>
<li>
<p>Obtain a <code>ServiceDescriptor</code> for a given service name</p>
</li>
<li>
<p>Obtain a list of matching <code>ServiceDescriptor</code> for a given set of tags (matches full set)</p>
</li>
<li>
<p>Advertise the provided local <code>ServiceDescriptor</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>How this happens internally, Muon Core doesn&#8217;t know nor care about. You can have a peering system (such as multicast), use a server (such as etcd) or something else (such as Muon AMQP which uses an AMQP broadcast exchange for discovery)</p>
</div>
<div class="paragraph">
<p>When Muon Core Java boots up, it reads properties from the <code>Autoconfiguration that it uses to initialise the Discovery and Transport lists. It does this by creating and invoking an instance of `MuonDiscoveryFactory</code>. This factory is passed the Autoconfiguration object during bootup (after all property sources have been read and applied), and so you can set properties to configure your discovery during creation.</p>
</div>
<div class="paragraph">
<p>Set the properties <code>muon.discovery.factories</code> to point at your implementation of <code>MuonDiscoveryFactory</code>, like so</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AutoConfiguration config <span style="color: #666666">=</span> MuonConfigBuilder<span style="color: #666666">.</span><span style="color: #7D9029">withServiceIdentifier</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;my-service&quot;</span><span style="color: #666666">).</span><span style="color: #7D9029">withTags</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;awesome&quot;</span><span style="color: #666666">)</span> <span style="color: #666666">(1)</span>
  <span style="color: #666666">.</span><span style="color: #7D9029">addWriter</span><span style="color: #666666">(</span>c <span style="color: #666666">-&gt;</span> <span style="color: #666666">{</span>
      c<span style="color: #666666">.</span><span style="color: #7D9029">getProperties</span><span style="color: #666666">().</span><span style="color: #7D9029">setProperty</span><span style="color: #666666">(</span>
              <span style="color: #BA2121">&quot;muon.discovery.factories&quot;</span><span style="color: #666666">,</span>
              <span style="color: #BA2121">&quot;io.muoncore.discovery.mine.MyDiscoveryTransportFactory&quot;</span><span style="color: #666666">);</span>                  <i class="conum" data-value="1"></i><b>(1)</b>

      c<span style="color: #666666">.</span><span style="color: #7D9029">getProperties</span><span style="color: #666666">().</span><span style="color: #7D9029">put</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;my.discovery.server&quot;</span><span style="color: #666666">,</span> <span style="color: #BA2121">&quot;someservername&quot;</span><span style="color: #666666">);</span>  <i class="conum" data-value="2"></i><b>(2)</b>
  <span style="color: #666666">}).</span><span style="color: #7D9029">build</span><span style="color: #666666">();</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configure the discovery list to be <code>MyDiscoveryTransportFactory</code>. This should be a comma separated list.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configure other properties that can affect the discovery. Here, a server name</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="create-a-discovery-for-muon-core-node">Create a Discovery for Muon Core Node</h3>

</div>
<div class="sect2">
<h3 id="create-a-discovery-as-a-native-library-for-java-node-future-muon">Create a Discovery as a Native Library for Java/ Node/ Future Muon</h3>

</div>
</div>
</div>
        </div>
      </div>

      <div class='four spacing'></div>
    </div>
  </div>
</div>
</div>

    </div>

    

  <!--End mc_embed_signup-->
<div class='full no-padding' style='background: #111'>
  <div class='two spacing'></div>
  <div class='row'>
    <div class='large-12 columns' style="color:white;">
      <p>Â©2017 Muon Core Ltd. All rights reserved.</p>
    </div>
  </div>
  <div class='spacing'></div>
</div>


<script src="/javascripts/jquery.countTo.js" type="text/javascript"></script>
<script src="/javascripts/jquery.appear.js" type="text/javascript"></script>
<script src="/javascripts/jquery.validate.js" type="text/javascript"></script>
<script src="/javascripts/jquery.sequence-min.js" type="text/javascript"></script>
<script src="/javascripts/jquery.easing.1.3.js" type="text/javascript"></script>
<script src="/javascripts/app.js" type="text/javascript"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-75338923-1', 'auto');
  ga('require', 'linkid');
  ga('send', 'pageview');

</script>


  </body>

</html>
