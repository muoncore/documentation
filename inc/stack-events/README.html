<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Muon - Reactive APIs</title>
  <meta name="description" content="">

    <link rel="stylesheet" href="/css/foundation.css">

    <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/fontello.css">
  <link rel="stylesheet" href="/css/font-awesome.css">
  <script src="/javascripts/modernizr.foundation.js" type="text/javascript"></script>
    <script src="/javascripts/jquery-2.1.0.js" type="text/javascript"></script>
    <script src="/javascripts/terrific-1.1.1.js" type="text/javascript"></script>
    <script src="/javascripts/jquery.url.js" type="text/javascript"></script>
    <script src="/javascripts/jquery.cookie.js" type="text/javascript"></script>
    <script src="/javascripts/json2.js" type="text/javascript"></script>
    <script src="/javascripts/foundation.js" type="text/javascript"></script>
  <script>
    // terrificjs bootstrap
    (function($) {
        $(document).ready(function() {
            var $page = $('body');
            var config = {
              dependencyPath: {
                plugin: 'javascripts/'
              }
            }
            var application = new Tc.Application($page, config);
            application.registerModules();
            application.start();
        });
    })(Tc.$);
  </script>
  <link href="http://fonts.googleapis.com/css?family=Raleway:400,700,300" media="screen" rel="stylesheet" type="text/css" />
  <script src="/javascripts/masonry.pkgd.js" type="text/javascript"></script>
  <script src="/javascripts/imagesloaded.pkgd.min.js" type="text/javascript"></script>
  <script src="/javascripts/slick.min.js" type="text/javascript"></script>

  <link rel="canonical" href="/inc/stack-events/README.html">
  <link rel="alternate" type="application/rss+xml" title="Muon - Reactive APIs" href="/feed.xml" />
  <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
          <link rel="stylesheet" href="/css/asciidoc.css">
          <link rel="stylesheet" href="/css/producttable.css">
                  <style>
  @media only screen and (min-width:768px){#toctitle{font-size:1.375em}
      body.toc2{padding-left:15em;padding-right:0}
#toc {margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;right:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc >ul{font-size:.9em;margin-bottom:0}
#toc ul ul{margin-left:0;padding-left:1em}
#toc ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
  @media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc {width:20em}
#toc #toctitle{font-size:1.375em}
#toc >ul{font-size:.95em}
#toc ul ul{padding-left:1.25em}
      body.toc2.toc-right{padding-left:0;padding-right:20em}}

#toc { z-index:20; padding-top:120px;}
#documentation { padding-left:10px; margin-left:auto; margin-right:auto}
#documentation .row { margin:auto }
      code {
          background:none;
          border:0;
      }

      code span { border: 0; width:100% }
      .listingblock {
         background: #eee;
         border-radius:5px;
          border:1px solid #ccc
      }
  }

  div.documentation a.btn {
    margin-top:20px;
    background: #3498db;
    background-image: -webkit-linear-gradient(top, #3498db, #2980b9);
    background-image: -moz-linear-gradient(top, #3498db, #2980b9);
    background-image: -ms-linear-gradient(top, #3498db, #2980b9);
    background-image: -o-linear-gradient(top, #3498db, #2980b9);
    background-image: linear-gradient(to bottom, #3498db, #2980b9);
    -webkit-border-radius: 28;
    -moz-border-radius: 28;
    border-radius: 28px;
    font-family: Arial;
    color: #ffffff;
    font-size: 20px;
    padding: 10px 20px 10px 20px;
    text-decoration: none;
  }

  div.documentation a.btn:hover {
    background: #3cb0fd;
    background-image: -webkit-linear-gradient(top, #3cb0fd, #3498db);
    background-image: -moz-linear-gradient(top, #3cb0fd, #3498db);
    background-image: -ms-linear-gradient(top, #3cb0fd, #3498db);
    background-image: -o-linear-gradient(top, #3cb0fd, #3498db);
    background-image: linear-gradient(to bottom, #3cb0fd, #3498db);
    text-decoration: none;
  }

  </style>

  <link rel="stylesheet" href="/css/sidebar2.css">
</head>


  <body>
    
      <a id='top'></a>
<div class='contain-to-grid sticky fullwidth'>
  <nav class='top-bar onepage' data-options='sticky_on: large' data-topbar=''>
    <ul class='title-area'>
      <li class='name'>
        <h1>
          <a href="/">
            <img alt="" src="/images/muonlogo.png" style="width:50px; height:50px" /> Muon
          </a>
        </h1>
      </li>
      <li class='toggle-topbar menu-icon'>
        <a href='#'>Menu</a>
      </li>
    </ul>
    <span style="float:left">Reactive APIs for Microservices, Browser and More ...</span>
    <section class='top-bar-section'>
      <ul class='right'>
        
          
            <li>
              
                <a href="/#ce">OSS/ CE</a>
              

            </li>
          
        
          
            <li>
              
                <a href="guide/index.html">Guides</a>
              

            </li>
          
        
          
            <li>
              
                <a href="/pro.html">Pro</a>
              

            </li>
          
        
          
            <li class="has-dropdown">
              <a href="/guide/index.html">Docs</a>
              <ul class='dropdown'>
                
                  <li>
                    <a href="/guide/index.html">Guides</a>
                  </li>
                
                  <li>
                    <a href="/submodules/cli/doc/index.html">CLI</a>
                  </li>
                
                  <li>
                    <a href="/submodules/java/doc/">Java</a>
                  </li>
                
                  <li>
                    <a href="/submodules/clojure/doc/index.html">Clojure</a>
                  </li>
                
                  <li>
                    <a href="/submodules/node/doc/index.html">Node.JS</a>
                  </li>
                
                  <li>
                    <a href="/submodules/muonjs/doc/index.html">Browser</a>
                  </li>
                
                  <li>
                    <a href="/submodules/photon/doc/index.html">Photon - Event Store</a>
                  </li>
                
              </ul>
            </li>
          
        
          
            <li>
              
                <a href="https://github.com/muoncore">Github</a>
              

            </li>
          
        
      </ul>
    </section>
  </nav>
</div>
<div class='full no-padding'>
  <!-- Begin MailChimp Signup Form -->
  <link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
  <style type="text/css">
    #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
    /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
         We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
  </style>
  <div id="mc_embed_signup">
    <form action="//simplicityitself.us9.list-manage.com/subscribe/post?u=fce1e12e8f44592cf75288e11&amp;id=98e2ce96d8" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
      <div id="mc_embed_signup_scroll">
        <label for="mce-EMAIL">Get updated on new releases and features</label>
        <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_fce1e12e8f44592cf75288e11_98e2ce96d8" tabindex="-1" value=""></div>
        <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
      </div>
    </form>
  </div>
</div>

    

    <div id='main' role='main'>
      <table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Master Build</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NPM Stable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Snapshots</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="https://img.shields.io/teamcity/http/teamcity.simplicityitself.com/e/OpenSource_MuonReleases_Stacks_EventsSnapshot.svg" alt="Status"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="https://img.shields.io/npm/v/muon-stack-event.svg" alt="NPM"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="https://img.shields.io/npm/v/muon-stack-event/next.svg" alt="NPM"></span></p></td>
</tr>
</tbody>
</table>
<div class="sect1">
<h2 id="event-persistence-muon-stack">Event Persistence Muon Stack</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="what-is-a-muon-stack">What is a Muon Stack?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Muon is a set of libraries and services that let you build highly effective distributed systems that are message and event oriented.</p>
</div>
<div class="paragraph">
<p>Muon is structured as a set of libraries, known as <code>muon-core</code> that give a set of infrastructure for building messaging systems. These are available in multiple languages and handle the concerns of discovery, transport, encoding and managing failures. On top of these, the exact messaging semantics that you want to express are built. These are built as a "stack", a set of channels, agents and finally a user facing API that you will use in your application code.</p>
</div>
<div class="paragraph">
<p>Muon has several such stacks, covering different scenarios and tasks, letting you communicate in various ways, highly distributed, cross platform and taking advantage of best of breed infrastructure and technologies.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-is-event-persistence">What is Event Persistence?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Event Driven Architectures (EDA) are a way for systems and components to interact based on the <em>things that have happened to them</em>, the events about them. Common problems with EDA are that :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>events can go missing when network transported</p>
</li>
<li>
<p>events can be missed if a component is offline</p>
</li>
<li>
<p>the history is often useful for stream processing analysis, trend detection and the like.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Persisting your events into an event store that permits events so be replayed on demand solves these issues. It allows your applications to emit events, observe them and then selectively replay the streams that you are interested in at some later point as well.</p>
</div>
<div class="paragraph">
<p>This stack implements an event streaming API client. You can use it to interact with a remote event store, emit events and replay streams on demand.</p>
</div>
<div class="paragraph">
<p>The server side is implemented by <a href="https://github.com/muoncore/photon">Photon</a> (A Clojure based Event Store with functional event Projections) or <a href="https://github.com/muoncore/photonlite">PhotonLite</a> (an event stream API layer)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-this-stack">Using this stack</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, you need to start up one of the event stores. If you have used the <a href="https://github.com/muoncore/muonstarter">Muon Starter</a> then you have this running already.</p>
</div>
<div class="sect2">
<h3 id="jvm">JVM</h3>
<div class="paragraph">
<p>To use the stack in Java, first import Muon, a transport/ discovery and the Event Stack</p>
</div>
<div class="paragraph">
<p><strong>build.gradle</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy">repositories <span style="color: #666666">{</span>
   jcenter<span style="color: #666666">()</span>
   maven <span style="color: #666666">{</span> url <span style="color: #BA2121">&#39;https://simplicityitself.artifactoryonline.com/simplicityitself/muon&#39;</span> <span style="color: #666666">}</span>
   maven <span style="color: #666666">{</span> url <span style="color: #BA2121">&#39;https://simplicityitself.artifactoryonline.com/simplicityitself/muon-snapshot&#39;</span> <span style="color: #666666">}</span>
<span style="color: #666666">}</span>

dependencies <span style="color: #666666">{</span>
   compile <span style="color: #BA2121">&quot;io.muoncore:muon-core:&lt;version&gt;&quot;</span>
   compile <span style="color: #BA2121">&quot;io.muoncore:muon-transport-amqp:&lt;version&gt;&quot;</span>
   compile <span style="color: #BA2121">&quot;io.muoncore:muon-discovery-amqp:&lt;version&gt;&quot;</span>
   compile <span style="color: #BA2121">&quot;io.muoncore.protocol:stack-event:&lt;version&gt;&quot;</span>
<span style="color: #666666">}</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="create-an-event-client">Create an Event Client</h4>
<div class="paragraph">
<p>This stack allows you to emit events and replay them. For replay, it exposes an API that uses Reactive Streams Publisher/ Subscribers to manage the subscription.</p>
</div>
<div class="paragraph">
<p>First then, you need to be able to obtain a Subscriber. If you don&#8217;t have one already, use a FRP system of some kind to make one. Consider using Spring Reactor, Akka Streams or RxJava, amongst others.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">Muon muon <span style="color: #666666">=</span> <span style="color: #666666">..</span> create a muon <span style="color: #666666">..;</span>

DefaultEventClient events <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> DefaultEventClient<span style="color: #666666">(</span>muon<span style="color: #666666">);</span>


events<span style="color: #666666">.</span><span style="color: #7D9029">event</span><span style="color: #666666">(</span>
        ClientEvent<span style="color: #666666">.</span><span style="color: #7D9029">ofType</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;UserRegistered&quot;</span><span style="color: #666666">)</span>
                <span style="color: #666666">.</span><span style="color: #7D9029">payload</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">new</span> UserRegistered<span style="color: #666666">(</span><span style="color: #BA2121">&quot;Roger&quot;</span><span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Rabbit&quot;</span><span style="color: #666666">))</span>
                <span style="color: #666666">.</span><span style="color: #7D9029">stream</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;users&quot;</span><span style="color: #666666">)</span>
                <span style="color: #666666">.</span><span style="color: #7D9029">build</span><span style="color: #666666">());</span>

Subscriber<span style="color: #666666">&lt;</span>Event<span style="color: #666666">&gt;</span> subscriber <span style="color: #666666">=</span> <span style="color: #666666">..</span> your subscriber <span style="color: #666666">..</span>

Map<span style="color: #666666">&lt;</span>String<span style="color: #666666">,</span> Object<span style="color: #666666">&gt;</span> args <span style="color: #666666">=</span> <span style="color: #666666">...</span>

<span style="color: #408080; font-style: italic">/*</span>
<span style="color: #408080; font-style: italic">available args:-</span>

<span style="color: #408080; font-style: italic">* from - the event order-id to replay from</span>

<span style="color: #408080; font-style: italic">*/</span>


events<span style="color: #666666">.</span><span style="color: #7D9029">replay</span><span style="color: #666666">(</span>
       <span style="color: #BA2121">&quot;users&quot;</span><span style="color: #666666">,</span>
       EventReplayMode<span style="color: #666666">.</span><span style="color: #7D9029">REPLAY_THEN_LIVE</span><span style="color: #666666">,</span>
       args<span style="color: #666666">,</span>
       subscriber<span style="color: #666666">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use these to selectively replay certain streams, play them back</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="node-js">Node.js</h3>
<div class="paragraph">
<p>To use the client event stack, import Muon, disco/ transport and the stack. This requires the reactive streams stack to be present.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>npm install --save muon-core@next
npm install --save muon-amqp@next  #or, any other transport+discovery here
npm install --save muon-stack-reactive-streams@next
npm install --save muon-stack-event@next</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, create a Muon instance and attach the Event client stack</p>
</div>
<div class="paragraph">
<p><strong>index.js</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span style="color: #008000; font-weight: bold">var</span> Muon <span style="color: #666666">=</span> require(<span style="color: #BA2121">&quot;muon-core&quot;</span>)

<span style="color: #008000; font-weight: bold">var</span> muonurl <span style="color: #666666">=</span> process.env.MUON_URL <span style="color: #666666">||</span> <span style="color: #BA2121">&quot;amqp://muon:microservices@localhost&quot;</span>

<span style="color: #008000; font-weight: bold">var</span> muon <span style="color: #666666">=</span> Muon.create(<span style="color: #BA2121">&quot;hello-world-node&quot;</span>, muonurl);           <i class="conum" data-value="1"></i><b>(1)</b>

require(<span style="color: #BA2121">&quot;muon-stack-reactive-streams&quot;</span>).create(muon)
require(<span style="color: #BA2121">&quot;muon-stack-event&quot;</span>).create(muon)                       <i class="conum" data-value="2"></i><b>(2)</b>

<span style="color: #008000; font-weight: bold">var</span> args <span style="color: #666666">=</span> {
  from<span style="color: #666666">:</span> <span style="color: #666666">&lt;</span>an<span style="color: #666666">-</span>order<span style="color: #666666">-</span>id<span style="color: #666666">&gt;</span>,
  stream<span style="color: #666666">-</span>type<span style="color: #666666">:</span> cold <span style="color: #666666">|</span> hot <span style="color: #666666">|</span> hot<span style="color: #666666">-</span>cold,
}


muon.emit({                                                   <i class="conum" data-value="3"></i><b>(3)</b>
        <span style="color: #BA2121">&quot;event-type&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;UserRegistered&quot;</span>,
        <span style="color: #BA2121">&quot;stream-name&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;users&quot;</span>,
        <span style="color: #BA2121">&quot;service-id&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;my-service&quot;</span>,
        payload<span style="color: #666666">:</span> {
          firstname<span style="color: #666666">:</span> <span style="color: #BA2121">&quot;John&quot;</span>,
          lastname<span style="color: #666666">:</span> <span style="color: #BA2121">&quot;Simples&quot;</span>
        }
    }).then(<span style="color: #008000; font-weight: bold">function</span> (resp) {
        logger.info(<span style="color: #BA2121">&quot;Slack message persisted&quot;</span>)
})


muon.replay(<span style="color: #BA2121">&quot;user&quot;</span>,{},                                         <i class="conum" data-value="4"></i><b>(4)</b>
   <span style="color: #008000; font-weight: bold">function</span>(data) {
       <span style="color: #408080; font-style: italic">// on data received</span>
   },
   <span style="color: #008000; font-weight: bold">function</span>(error) {
       <span style="color: #408080; font-style: italic">// on error</span>
   },
   <span style="color: #008000; font-weight: bold">function</span>() {
       <span style="color: #408080; font-style: italic">// on complete</span>
   }
)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a new Muon instance, connecting to a local AMQP broker for discovery and transport</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add the event stack, in addition to the reactive streams stack.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use the added <code>emit</code> method to persist events</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Use the added <code>replay</code> method to replay historical events and continue to listen to new events</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-involved-adding-to-this-stack">Getting involved/ adding to this stack.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Additions and extensions to this stack are very welcome.</p>
</div>
<div class="paragraph">
<p>Particularly of interest are :-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Added language support</p>
</li>
<li>
<p>Integrate with javascript FRP libraries.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="license">License</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All code is Copyright (c) Muon Core Ltd 2017.</p>
</div>
<div class="paragraph">
<p>Muon is Free Software, licensed under the terms of
the LGPLv3 license as included in <a href="LICENSE" class="bare">LICENSE</a></p>
</div>
<div class="paragraph">
<p>Muon has a commercial-friendly license allowing private forks and closed modifications of all projects, alongside enterprise support and extended support for enterprise technologies and patterns.</p>
</div>
<div class="paragraph">
<p>This will enable you to use Muon in any situation where your legal team will not accept a Free Software license.</p>
</div>
<div class="paragraph">
<p>Please see <a href="http://muoncore.io/pro/" class="bare">http://muoncore.io/pro/</a> for more detail.  You can find the commercial license terms in <a href="COMM-LICENSE" class="bare">COMM-LICENSE</a></p>
</div>
</div>
</div>
    </div>

    

  <!--End mc_embed_signup-->
<div class='full no-padding' style='background: #111'>
  <div class='two spacing'></div>
  <div class='row'>
    <div class='large-12 columns' style="color:white;">
      <p>©2017 Muon Core Ltd. All rights reserved.</p>
    </div>
  </div>
  <div class='spacing'></div>
</div>


<script src="/javascripts/jquery.countTo.js" type="text/javascript"></script>
<script src="/javascripts/jquery.appear.js" type="text/javascript"></script>
<script src="/javascripts/jquery.validate.js" type="text/javascript"></script>
<script src="/javascripts/jquery.sequence-min.js" type="text/javascript"></script>
<script src="/javascripts/jquery.easing.1.3.js" type="text/javascript"></script>
<script src="/javascripts/app.js" type="text/javascript"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-75338923-1', 'auto');
  ga('require', 'linkid');
  ga('send', 'pageview');

</script>


  </body>

</html>
