<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Muon - Reactive APIs</title>
  <meta name="description" content="">

    <link rel="stylesheet" href="/css/foundation.css">

    <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/fontello.css">
  <link rel="stylesheet" href="/css/font-awesome.css">
  <script src="/javascripts/modernizr.foundation.js" type="text/javascript"></script>
    <script src="/javascripts/jquery-2.1.0.js" type="text/javascript"></script>
    <script src="/javascripts/terrific-1.1.1.js" type="text/javascript"></script>
    <script src="/javascripts/jquery.url.js" type="text/javascript"></script>
    <script src="/javascripts/jquery.cookie.js" type="text/javascript"></script>
    <script src="/javascripts/json2.js" type="text/javascript"></script>
    <script src="/javascripts/foundation.js" type="text/javascript"></script>
  <script>
    // terrificjs bootstrap
    (function($) {
        $(document).ready(function() {
            var $page = $('body');
            var config = {
              dependencyPath: {
                plugin: 'javascripts/'
              }
            }
            var application = new Tc.Application($page, config);
            application.registerModules();
            application.start();
        });
    })(Tc.$);
  </script>
  <link href="http://fonts.googleapis.com/css?family=Raleway:400,700,300" media="screen" rel="stylesheet" type="text/css" />
  <script src="/javascripts/masonry.pkgd.js" type="text/javascript"></script>
  <script src="/javascripts/imagesloaded.pkgd.min.js" type="text/javascript"></script>
  <script src="/javascripts/slick.min.js" type="text/javascript"></script>

  <link rel="canonical" href="/inc/guides/eventguide/eventguide.html">
  <link rel="alternate" type="application/rss+xml" title="Muon - Reactive APIs" href="/feed.xml" />
  <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
          <link rel="stylesheet" href="/css/asciidoc.css">
          <link rel="stylesheet" href="/css/producttable.css">
                  <style>
  @media only screen and (min-width:768px){#toctitle{font-size:1.375em}
      body.toc2{padding-left:15em;padding-right:0}
#toc {margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;right:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc >ul{font-size:.9em;margin-bottom:0}
#toc ul ul{margin-left:0;padding-left:1em}
#toc ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
  @media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc {width:20em}
#toc #toctitle{font-size:1.375em}
#toc >ul{font-size:.95em}
#toc ul ul{padding-left:1.25em}
      body.toc2.toc-right{padding-left:0;padding-right:20em}}

#toc { z-index:20; padding-top:120px;}
#documentation { padding-left:10px; margin-left:auto; margin-right:auto}
#documentation .row { margin:auto }
      code {
          background:none;
          border:0;
      }

      code span { border: 0; width:100% }
      .listingblock {
         background: #eee;
         border-radius:5px;
          border:1px solid #ccc
      }
  }

  div.documentation a.btn {
    margin-top:20px;
    background: #3498db;
    background-image: -webkit-linear-gradient(top, #3498db, #2980b9);
    background-image: -moz-linear-gradient(top, #3498db, #2980b9);
    background-image: -ms-linear-gradient(top, #3498db, #2980b9);
    background-image: -o-linear-gradient(top, #3498db, #2980b9);
    background-image: linear-gradient(to bottom, #3498db, #2980b9);
    -webkit-border-radius: 28;
    -moz-border-radius: 28;
    border-radius: 28px;
    font-family: Arial;
    color: #ffffff;
    font-size: 20px;
    padding: 10px 20px 10px 20px;
    text-decoration: none;
  }

  div.documentation a.btn:hover {
    background: #3cb0fd;
    background-image: -webkit-linear-gradient(top, #3cb0fd, #3498db);
    background-image: -moz-linear-gradient(top, #3cb0fd, #3498db);
    background-image: -ms-linear-gradient(top, #3cb0fd, #3498db);
    background-image: -o-linear-gradient(top, #3cb0fd, #3498db);
    background-image: linear-gradient(to bottom, #3cb0fd, #3498db);
    text-decoration: none;
  }

  </style>

  <link rel="stylesheet" href="/css/sidebar2.css">
</head>


  <body>
    
      <a id='top'></a>
<div class='contain-to-grid sticky fullwidth'>
  <nav class='top-bar onepage' data-options='sticky_on: large' data-topbar=''>
    <ul class='title-area'>
      <li class='name'>
        <h1>
          <a href="/">
            <img alt="" src="/images/muonlogo.png" style="width:50px; height:50px" /> Muon
          </a>
        </h1>
      </li>
      <li class='toggle-topbar menu-icon'>
        <a href='#'>Menu</a>
      </li>
    </ul>
    <span style="float:left">Reactive APIs for Microservices, Browser and More ...</span>
    <section class='top-bar-section'>
      <ul class='right'>
        
          
            <li>
              
                <a href="/#ce">OSS/ CE</a>
              

            </li>
          
        
          
            <li>
              
                <a href="guide/index.html">Guides</a>
              

            </li>
          
        
          
            <li>
              
                <a href="/pro.html">Pro</a>
              

            </li>
          
        
          
            <li class="has-dropdown">
              <a href="/guide/index.html">Docs</a>
              <ul class='dropdown'>
                
                  <li>
                    <a href="/guide/index.html">Guides</a>
                  </li>
                
                  <li>
                    <a href="/submodules/cli/doc/index.html">CLI</a>
                  </li>
                
                  <li>
                    <a href="/submodules/java/doc/">Java</a>
                  </li>
                
                  <li>
                    <a href="/submodules/clojure/doc/index.html">Clojure</a>
                  </li>
                
                  <li>
                    <a href="/submodules/node/doc/index.html">Node.JS</a>
                  </li>
                
                  <li>
                    <a href="/submodules/muonjs/doc/index.html">Browser</a>
                  </li>
                
                  <li>
                    <a href="/submodules/photon/doc/index.html">Photon - Event Store</a>
                  </li>
                
              </ul>
            </li>
          
        
          
            <li>
              
                <a href="https://github.com/muoncore">Github</a>
              

            </li>
          
        
      </ul>
    </section>
  </nav>
</div>
<div class='full no-padding'>
  <!-- Begin MailChimp Signup Form -->
  <link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
  <style type="text/css">
    #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
    /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
         We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
  </style>
  <div id="mc_embed_signup">
    <form action="//simplicityitself.us9.list-manage.com/subscribe/post?u=fce1e12e8f44592cf75288e11&amp;id=98e2ce96d8" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
      <div id="mc_embed_signup_scroll">
        <label for="mce-EMAIL">Get updated on new releases and features</label>
        <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_fce1e12e8f44592cf75288e11_98e2ce96d8" tabindex="-1" value=""></div>
        <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
      </div>
    </form>
  </div>
</div>

    

    <div id='main' role='main'>
      <div id="toc" class="toc">
<div id="toctitle">Event Microservices</div>
<ul class="sectlevel1">
<li><a href="#setup">Setup</a></li>
<li><a href="#understanding-events">Understanding Events</a></li>
<li><a href="#design-your-events">Design Your Events</a></li>
<li><a href="#emitting-an-event">Emitting an Event</a></li>
<li><a href="#subscribing-and-acting-on-events">Subscribing and acting on Events</a></li>
<li><a href="#replaying-an-event-stream-building-an-event-sourced-aggregation-from-an-event-stream">Replaying an Event Stream - Building an Event Sourced Aggregation from an Event Stream</a></li>
<li><a href="#using-an-event-projection-in-place-of-an-aggregation">Using an Event Projection in place of an Aggregation</a></li>
</ul>
</div>
<div class="paragraph">
<p>Learning how to use event data in Muon.</p>
</div>
<div class="sect1">
<h2 id="setup">Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MicroserviceUX provides specific facilities for managing event based, stream oriented data. As in all things, this is available
as a set of distinct microservices. When running, they provide a data platform for building event based systems.</p>
</div>
<div class="paragraph">
<p>TODO - MENTION PHOTON, OTHERS?</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="understanding-events">Understanding Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Understanding your data, how it moves, what it means, is one of the most useful and powerful things that you as a software developer
can do. Too often the pressure is on to understand your data in terms of how it should be <em>presented</em>. By it&#8217;s very nature this means
that you take a snapshot in time of your data, and fold it into the shap you want. Often, you will do this ahead of time in the form
of a normalised database schema.</p>
</div>
<div class="paragraph">
<p>Imagine if you didn&#8217;t do this. Imagine instead that you looked on your data as it changes, on what <em>happens</em> to make it.</p>
</div>
<div class="paragraph">
<p>This is the nature of event based systems, they are described in terms of <em>what happens</em> rather than what questions you want to answer later on.</p>
</div>
<div class="paragraph">
<p>THe MicroserviceUX toolkit has this baked in deeply, and via the Photon project and event client libraries, can give you a rich, simple event
model that focuses on <strong>events</strong>, <strong>streams</strong> and queries across projections that we refer to as <strong>projections</strong>.</p>
</div>
<div class="paragraph">
<p>The Microservice architecture is intented to enable change, primarily by generating isolation between services, often using a network,
sometimes using some other common interface.</p>
</div>
<div class="paragraph">
<p>Adding events into the mix, specifically event sourcing, allows decoupling in time. Many times your services are truly connected in time
(<em>what is the current basket state</em>), however many things truly aren&#8217;t connected in time (<em>eg, send an email</em>).</p>
</div>
<div class="paragraph">
<p>Event architectures give you this option.</p>
</div>
<div class="paragraph">
<p>The rest of this guide will show you how to build an event based system using MicroserviceUX technologies.</p>
</div>
<div class="paragraph">
<p>We will be implementing a user registration system, allowing the creation of user accounts and loading / using a user account.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="design-your-events">Design Your Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When building an event based system, the first thing you need to figure out is <em>what should happen</em>, a series of things that you expect to occur, along with the data that goes with that.
These actions, happenings, are your events. Next, you can figure out how to convert the data in your events into something you can query.</p>
</div>
<div class="paragraph">
<p>For our user registration system, the following things will happen :-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User registers</p>
</li>
<li>
<p>User updates their record</p>
</li>
<li>
<p>User removes their record</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will want to show :-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a list of the current users</p>
</li>
<li>
<p>a single user account</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="emitting-an-event">Emitting an Event</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To get started, we need to be able to emit an event. We will have two events in the system to start with, <code><code>UserRegistered</code></code> and <code><code>UserRemoved</code></code></p>
</div>
<div class="paragraph">
<p>UserRegistered will look like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code> username: &lt;string&gt;
 firstname: &lt;string&gt;
 lastname: &lt;string&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>UserRemoved will look like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code> username: &lt;string&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using Muon, this is easy, you obtain the <em>Event Client</em>, and then call emit.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="{language}">Unresolved directive in eventguide.adoc - include::{emitevent}[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is all!  Your event is now persisted, and available for replay or analysis.</p>
</div>
<div class="paragraph">
<p>It is possible to react to events as they are emitted by <em>subscribing</em> to the appropriate event stream.
Your code will then receive a push notification whenever an event is emitted.</p>
</div>
<div class="paragraph">
<p>You can also, after the fact, replay all of the events and do some analysis. You may also combine these, replay the historical events
and then once they have been consumed, continue to process new events, live, as they are emitted.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="subscribing-and-acting-on-events">Subscribing and acting on Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All events in MicroserviceUX are arranged into <em>streams</em>. These are ordered, serial lists of events, stored in the order
that they were persisted in.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Try doing this part in another language to your emitting code and see how they work together.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Your microservices can subscribe to a stream to be notified whenever a new event occurs, so they can react to it, use it, or discard it.</p>
</div>
<div class="paragraph">
<p>Subscribe a service to the user stream using the event client. This will notify your service of the user events as they occur. You can act on these to take further
 actions, sending an email, validating an account etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="{language}">Unresolved directive in eventguide.adoc - include::{subscribeevent}[]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="replaying-an-event-stream-building-an-event-sourced-aggregation-from-an-event-stream">Replaying an Event Stream - Building an Event Sourced Aggregation from an Event Stream</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We want to build a list of users. To do that, we have to transform the events as they come into our service to generate an aggregation of the events.</p>
</div>
<div class="paragraph">
<p>To do this, we build a simple data sturcture, a list, and then for every event that we are notified of, we change the list. If we take all the events that have ever occurred,
we can rebuild our current state at any time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="{language}">Unresolved directive in eventguide.adoc - include::{buildaggregation}[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This maintains the list of users in memory, for the fastest possible access. Rebuilding the list of users is natural, if potentially involved, by
replaying the users stream on demand. In the case of the user service crashing, the user list will be recreated from the event stream.</p>
</div>
<div class="paragraph">
<p>The user data is in a very convenient representation, a queryable list, but it is <strong>mastered</strong> elsewhere, in the event store.</p>
</div>
<div class="paragraph">
<p>This pattern of generating an aggregation across an event stream is very common, and so we have created a special <em>Projection</em> service
in the event system of MicroserviceUX.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-an-event-projection-in-place-of-an-aggregation">Using an Event Projection in place of an Aggregation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To build an event projection, you need to understand the algorithm that you have just written. This is a general purpose computation known as a
<em>reducer</em>. It takes an initial state and for a stream of data items applies a mutation to the state before moving on to process the next item
in the list. It is fairly simple, general purpose and able to be parallelised.</p>
</div>
<div class="paragraph">
<p>The Photon store or Collider projection host can take a reducer function and associated metadata and generate an event projection on a stream.</p>
</div>
<div class="paragraph">
<p>This allows you to do the work you did in your service and push it back into the MicroserviceUX data tier.</p>
</div>
<div class="paragraph">
<p>To do this, you first need to insert a projection. This can be written in a variety of languages, here it is in {projectionlanguage}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="{projectionlanguage}">Unresolved directive in eventguide.adoc - include::{userlistprojection}[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This simply folds the stream data into a list. Every UserRegistered event acts as an insert, every UserRemoved acts as a delete.</p>
</div>
<div class="paragraph">
<p>You may register this using the event client like so</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="{language}">Unresolved directive in eventguide.adoc - include::{installprojection}[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will run against the event stream, and maintain an up to date list representation of your users. You can query the state of the projection
as below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="{language}">Unresolved directive in eventguide.adoc - include::{useprojection}[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your user service can now become a much simpler system, delivering a user friendly API on top of an event projection.</p>
</div>
</div>
</div>
    </div>

    

  <!--End mc_embed_signup-->
<div class='full no-padding' style='background: #111'>
  <div class='two spacing'></div>
  <div class='row'>
    <div class='large-12 columns' style="color:white;">
      <p>©2017 Muon Core Ltd. All rights reserved.</p>
    </div>
  </div>
  <div class='spacing'></div>
</div>


<script src="/javascripts/jquery.countTo.js" type="text/javascript"></script>
<script src="/javascripts/jquery.appear.js" type="text/javascript"></script>
<script src="/javascripts/jquery.validate.js" type="text/javascript"></script>
<script src="/javascripts/jquery.sequence-min.js" type="text/javascript"></script>
<script src="/javascripts/jquery.easing.1.3.js" type="text/javascript"></script>
<script src="/javascripts/app.js" type="text/javascript"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-75338923-1', 'auto');
  ga('require', 'linkid');
  ga('send', 'pageview');

</script>


  </body>

</html>
