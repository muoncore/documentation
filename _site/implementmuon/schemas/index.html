<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Muon - Microservice UX</title>
  <meta name="description" content="">

    <link rel="stylesheet" href="/css/foundation.css">

    <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/fontello.css">
  <link rel="stylesheet" href="/css/font-awesome.css">
  <script src="/javascripts/modernizr.foundation.js" type="text/javascript"></script>
    <script src="/javascripts/jquery-2.1.0.js" type="text/javascript"></script>
    <script src="/javascripts/terrific-1.1.1.js" type="text/javascript"></script>
    <script src="/javascripts/jquery.url.js" type="text/javascript"></script>
    <script src="/javascripts/jquery.cookie.js" type="text/javascript"></script>
    <script src="/javascripts/json2.js" type="text/javascript"></script>
    <script src="/javascripts/foundation.js" type="text/javascript"></script>
  <script>
    // terrificjs bootstrap
    (function($) {
        $(document).ready(function() {
            var $page = $('body');
            var config = {
              dependencyPath: {
                plugin: 'javascripts/'
              }
            }
            var application = new Tc.Application($page, config);
            application.registerModules();
            application.start();
        });
    })(Tc.$);
  </script>
  <link href="http://fonts.googleapis.com/css?family=Raleway:400,700,300" media="screen" rel="stylesheet" type="text/css" />
  <script src="/javascripts/masonry.pkgd.js" type="text/javascript"></script>
  <script src="/javascripts/imagesloaded.pkgd.min.js" type="text/javascript"></script>
  <script src="/javascripts/slick.min.js" type="text/javascript"></script>

  <link rel="canonical" href="/implementmuon/schemas/">
  <link rel="alternate" type="application/rss+xml" title="Muon - Microservice UX" href="/feed.xml" />
  <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
          <link rel="stylesheet" href="/css/asciidoc.css">
                  <style>
  @media only screen and (min-width:768px){#toctitle{font-size:1.375em}
      body.toc2{padding-left:15em;padding-right:0}
#toc {margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;right:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc >ul{font-size:.9em;margin-bottom:0}
#toc ul ul{margin-left:0;padding-left:1em}
#toc ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
  @media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc {width:20em}
#toc #toctitle{font-size:1.375em}
#toc >ul{font-size:.95em}
#toc ul ul{padding-left:1.25em}
      body.toc2.toc-right{padding-left:0;padding-right:20em}}

#toc { z-index:20; padding-top:120px;}
#documentation { padding-left:10px; margin-left:auto; margin-right:auto}
#documentation .row { margin:auto }
      code {
          background:none;
          border:0;
          display:block;
          width:100%;
      }

      code span { border: 0; width:100% }
      .listingblock {
         background: #eee;
         border-radius:5px;
          border:1px solid #ccc
      }
  }

  </style>
</head>


  <body>
    
      <a id='top'></a>
<div class='contain-to-grid sticky fullwidth'>
  <nav class='top-bar onepage' data-options='sticky_on: large' data-topbar=''>
    <ul class='title-area'>
      <li class='name'>
        <h1>
          <a href="/">
            <img alt="" src="/images/muonfulllogo-sm.jpg" />
          </a>
        </h1>
      </li>
      <li class='toggle-topbar menu-icon'>
        <a href='#'>Menu</a>
      </li>
    </ul>
    <section class='top-bar-section'>
      <ul class='right'>
        
          
            <li>
              
                <a href="/#top">Home</a>
              

            </li>
          
        
          
            <li>
              
                <a href="/#whymuon">Why Muon</a>
              

            </li>
          
        
          
            <li>
              
                <a href="/#ecosystem">Ecosystem</a>
              

            </li>
          
        
          
            <li>
              
                <a href="/#gettingstarted">Getting Started</a>
              

            </li>
          
        
          
            <li class="has-dropdown">
              <a href="/languages.html">Muon Documentation</a>
              <ul class='dropdown'>
                
                  <li>
                    <a href="/guide/index.html">MicroserviceUX Guides</a>
                  </li>
                
                  <li>
                    <a href="/java/SNAPSHOT/">Muon - Java</a>
                  </li>
                
                  <li>
                    <a href="/clojure/SNAPSHOT">Muon - Clojure</a>
                  </li>
                
                  <li>
                    <a href="/node/latest">Muon - Node.JS</a>
                  </li>
                
                  <li>
                    <a href="/node/latest">Muon - JavaScript/ Browser</a>
                  </li>
                
                  <li>
                    <a href="/implementmuon/index.html">&#x2B; your Language</a>
                  </li>
                
              </ul>
            </li>
          
        
          
            <li>
              
                <a href="/https://github.com/microserviceux">Github</a>
              

            </li>
          
        
      </ul>
    </section>
  </nav>
</div>
    

    <div id='main' role='main'>
      <div class="documentation">
<div class='full' style='background: #000'>
  <div class='row' style="margin-left:auto; margin-right:auto; max-width:90rem">
    <div class='large-12 columns'>
      <div class='mod modBlogPost big'>
        <div class='images'>
          
        </div>
        <div class='content' style="font-size:1.2rem">
          <h3><a href="/implementmuon/schemas/"></a></h3>

          <div class="sect1">
<h2 id="schemas">Schemas</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is a new schema definition that will be released in release train <strong>7.0</strong></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="protocol-messages">Protocol Messages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each Protocol will define the messages that it will emit on the app/ API side. How these are interpreted
by either application code or APIs is out of scope of this document.</p>
</div>
<div class="paragraph">
<p>TODO - reference protocol design docs for more information</p>
</div>
<div class="sect2">
<h3 id="rpc-message">RPC Message</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>{
  headers: {hashmap/json object}
  payload: [object]
  error: [object]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="muon-message">Muon Message</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is the message format that exists between transport and protocols. It is the standardised Muon
message that forms the standard interface between all protocols and transports.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>{
  id: [guid]
  created [timestamp] &lt;datetime event created&gt;
  target_service: [string, required] &lt;name of service this message goes to&gt; eg: "user-service"
  origin_service: [string, required] &lt;name of service message originated from&gt; eg: "auth-service"
  url: [string, required] "protocol://host/reosurce"
  protocol: [enum, required] &lt;protocol name eg:&gt; rpc | streaming | events | cqrs | etc..
  step: [enum, required] &lt;protocol specific step&gt; request_made | request_response | stream_request | etc..
  provenance_id: [uuid, optional] --reserved for provenance use--
  content_type: [string, required if payload] "main/subtype"
  status: [enum, optional: on reply] success | failure | error
  payload: [byte[array], optional] &lt;object&gt;
  channel_op: [enum, string] normal | closed | shutdown
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="transport-wire-level-messages">Transport &amp; Wire level messages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>These are the message formats that should be sent between transport instances. The exact details of the
 schema may vary between transports. The intent is to transport the Muon message above from one service
  process to another.</p>
</div>
<div class="paragraph">
<p>Here are the details of the messages between amqp transports.</p>
</div>
<div class="sect2">
<h3 id="amqp-transport-wire-message-headers">AMQP Transport Wire Message Headers</h3>
<div class="paragraph">
<p>{
  protocol: [enum, required] &lt;protocol name&gt; request | streaming | event
  handsake: [enum, optional] &lt;handshake protocol step&gt; initiated | accetped
  sever_reply_q: [string, required IF handshake] &lt;unique queue for the server to reply on&gt;  "$server-name.reply.GUID"
  server_listen_q: [string, required IF handshake] &lt;unique queue for the server to listen on&gt; "$server-name.listen.GUID"
  content_type: [string,  required if message payload] &lt;describe message contents type&gt; "main/subtype"
}</p>
</div>
<div class="paragraph">
<p>The AMQP transport has two different classes of message, handshake and channel.</p>
</div>
<div class="sect3">
<h4 id="handshake">Handshake</h4>
<div class="paragraph">
<p>These messages are used internally by the AMQP transport to establish channels.</p>
</div>
<div class="paragraph">
<p>They will <em>never</em> be seen by protocols, or any code outside of the AMQP transport.</p>
</div>
<div class="paragraph">
<p>Service A will create two queues that will form the channel.</p>
</div>
<div class="paragraph">
<p>Then, Service A will send a handshake request to Service B on the <em>service queue</em> of Service B with the following headers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>{
  protocol: "rpc"
  handshake: "initiated"
  sever_reply_q: "example-server.reply.B557C6A2-90F8-43C5-A55A-4DEFDD70D261"
  server_listen_q: "example-server.listen.B557C6A2-90F8-43C5-A55A-4DEFDD70D261"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Service B will then process the handshake request, instantiate a channel to the appropriate server protocol, and then
 send a handshake response back to Service A down the temporary muon socket queue (in this case: "example-server.reply.B557C6A2-90F8-43C5-A55A-4DEFDD70D261") with the following headers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>{
  protocol: "rpc"
  handshake: "accepted"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once this has been established, the channel is live and channel messages will flow over it, originating from outside the transport.</p>
</div>
</div>
<div class="sect3">
<h4 id="amqp-wire-level-message-schema">AMQP Wire level Message schema</h4>
<div class="paragraph">
<p>The AMQP transport uses this schema to send messages along channels.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>{
  properties: {
    headers: {
      protocol: "rpc"
      content_type: "application/json"
    }
  },
  fields: {}
  content: &lt;object: MuonMessage&gt;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
        </div>
      </div>

      <div class='four spacing'></div>
    </div>
  </div>
</div>
</div>
    </div>

    <div class='full no-padding' style='background: #111'>
  <div class='two spacing'></div>
  <div class='row'>
    <div class='large-12 columns' style="color:white;">
      <p>©2016 Muon Core Ltd. All rights reserved.</p>
    </div>
  </div>
  <div class='spacing'></div>
</div>


<script src="/javascripts/jquery.countTo.js" type="text/javascript"></script>
<script src="/javascripts/jquery.appear.js" type="text/javascript"></script>
<script src="/javascripts/jquery.validate.js" type="text/javascript"></script>
<script src="/javascripts/jquery.sequence-min.js" type="text/javascript"></script>
<script src="/javascripts/jquery.easing.1.3.js" type="text/javascript"></script>
<script src="/javascripts/app.js" type="text/javascript"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-75338923-1', 'auto');
  ga('require', 'linkid');
  ga('send', 'pageview');

</script>


  </body>

</html>
